# DCC数字员工系统环境变量配置说明

## 概述

本系统支持多环境配置，通过环境变量来区分开发、测试和生产环境。所有敏感信息（如数据库密码、API密钥等）都通过环境变量管理，确保不会提交到GitHub。

## 环境变量文件

### 1. 环境变量示例文件
- 文件位置：`backend/env.example`
- 作用：提供所有环境变量的模板和说明
- 安全：可以安全提交到GitHub

### 2. 实际环境变量文件
- 文件位置：`backend/.env`
- 作用：存储实际的环境变量值
- 安全：被`.gitignore`忽略，不会提交到GitHub

## 环境变量列表

### 基础配置
| 变量名 | 说明 | 默认值 | 必需 |
|--------|------|--------|------|
| `ENVIRONMENT` | 运行环境 | development | 是 |
| `DEBUG` | 调试模式 | False | 否 |

### 数据库配置
| 变量名 | 说明 | 默认值 | 必需 |
|--------|------|--------|------|
| `DB_HOST` | 数据库主机 | localhost | 是 |
| `DB_PORT` | 数据库端口 | 3306 | 否 |
| `DB_USER` | 数据库用户名 | root | 是 |
| `DB_PASSWORD` | 数据库密码 | - | 是 |
| `DB_NAME` | 数据库名称 | dcc_employee_db | 是 |

### JWT配置
| 变量名 | 说明 | 默认值 | 必需 |
|--------|------|--------|------|
| `JWT_SECRET_KEY` | JWT密钥 | dcc-jwt-secret-key-2024 | 否 |
| `JWT_EXPIRE_HOURS` | JWT过期时间(小时) | 24 | 否 |

### 阿里云配置
| 变量名 | 说明 | 默认值 | 必需 |
|--------|------|--------|------|
| `ALIBABA_CLOUD_ACCESS_KEY_ID` | 阿里云访问密钥ID | - | 是 |
| `ALIBABA_CLOUD_ACCESS_KEY_SECRET` | 阿里云访问密钥 | - | 是 |
| `INSTANCE_ID` | 实例ID | - | 是 |

### 阿里百炼配置
| 变量名 | 说明 | 默认值 | 必需 |
|--------|------|--------|------|
| `DASHSCOPE_API_KEY` | DashScope API密钥 | - | 是 |
| `ALIBAILIAN_APP_ID` | 阿里百炼应用ID | - | 是 |

### 外部API配置
| 变量名 | 说明 | 默认值 | 必需 |
|--------|------|--------|------|
| `SCENE_ID_API_URL` | 场景ID API地址 | https://your-external-api.com/get-scene-id | 否 |
| `API_TIMEOUT` | API超时时间(秒) | 30 | 否 |
| `EXTERNAL_API_TOKEN` | 外部API令牌 | - | 否 |

## 环境配置

### 开发环境 (Development)
```bash
ENVIRONMENT=development
DEBUG=True
```

### 测试环境 (Testing)
```bash
ENVIRONMENT=testing
DEBUG=True
```

### 生产环境 (Production)
```bash
ENVIRONMENT=production
DEBUG=False
```

## 配置步骤

### 1. 创建环境变量文件
```bash
# 复制示例文件
cp backend/env.example backend/.env

# 编辑环境变量
vim backend/.env
```

### 2. 配置环境变量
根据您的实际环境，修改`.env`文件中的值：

```bash
# 开发环境示例
ENVIRONMENT=development
DEBUG=True

# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password_here
DB_NAME=dcc_employee_db

# 阿里云配置
ALIBABA_CLOUD_ACCESS_KEY_ID=your_access_key_id
ALIBABA_CLOUD_ACCESS_KEY_SECRET=your_access_key_secret
INSTANCE_ID=your_instance_id

# 阿里百炼配置
DASHSCOPE_API_KEY=your_dashscope_api_key
ALIBAILIAN_APP_ID=your_alibailian_app_id
```

## 部署方式

### 1. 使用部署脚本
```bash
# 开发环境部署
./backend/deploy.sh development

# 生产环境部署
./backend/deploy.sh production

# 测试环境部署
./backend/deploy.sh testing
```

### 2. 使用Docker Compose
```bash
# 启动所有服务
docker-compose up -d

# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f
```

### 3. 直接运行
```bash
# 设置环境变量
export ENVIRONMENT=development
export DEBUG=True

# 安装依赖
pip install -r backend/requirements.txt

# 运行应用
cd backend
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

## 安全注意事项

1. **永远不要提交`.env`文件到GitHub**
   - `.env`文件已被`.gitignore`忽略
   - 只提交`env.example`作为模板

2. **生产环境安全**
   - 使用强密码和密钥
   - 定期轮换密钥
   - 限制数据库访问权限

3. **环境变量管理**
   - 使用不同的密钥用于不同环境
   - 定期更新密钥
   - 监控密钥使用情况

## 故障排除

### 常见问题

1. **环境变量未加载**
   ```bash
   # 检查.env文件是否存在
   ls -la backend/.env
   
   # 检查环境变量是否正确设置
   echo $ENVIRONMENT
   ```

2. **数据库连接失败**
   ```bash
   # 检查数据库配置
   docker-compose logs mysql
   
   # 检查网络连接
   docker-compose exec backend ping mysql
   ```

3. **服务启动失败**
   ```bash
   # 查看服务日志
   docker-compose logs backend
   
   # 检查端口占用
   netstat -tulpn | grep 8000
   ```

### 调试模式

在开发环境中启用调试模式：
```bash
export DEBUG=True
export ENVIRONMENT=development
```

这将启用详细的错误信息和调试输出。

## 更新配置

当需要更新环境变量时：

1. 更新`env.example`文件（添加新的变量说明）
2. 更新`config.py`文件（添加新的配置项）
3. 更新相关代码文件
4. 更新部署文档

确保所有环境都正确配置了新的环境变量。

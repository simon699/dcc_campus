# 环境配置说明

## 概述

本项目已实现环境配置系统，支持开发环境、生产环境和测试环境使用不同的API地址。

## 配置方法

### 1. 创建环境变量文件

在项目根目录创建 `.env.local` 文件（如果不存在）：

```bash
# 开发环境配置
NEXT_PUBLIC_API_BASE_URL=http://localhost:8000/api
NODE_ENV=development
```

### 2. 不同环境的配置

#### 开发环境 (.env.local)
```bash
NEXT_PUBLIC_API_BASE_URL=http://localhost:8000/api
NODE_ENV=development
```

#### 生产环境 (.env.production)
```bash
NEXT_PUBLIC_API_BASE_URL=https://your-production-domain.com/api
NODE_ENV=production
```

#### 测试环境 (.env.test)
```bash
NEXT_PUBLIC_API_BASE_URL=https://your-test-domain.com/api
NODE_ENV=test
```

## 使用方法

### 在代码中使用

```typescript
import { API_BASE_URL, isDevelopment, isProduction } from '../config/environment';

// 使用API基础URL
const response = await fetch(`${API_BASE_URL}/login`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({ username, password }),
});

// 根据环境执行不同逻辑
if (isDevelopment) {
  console.log('开发环境');
} else if (isProduction) {
  console.log('生产环境');
}
```

### 环境变量优先级

1. `NEXT_PUBLIC_API_BASE_URL` 环境变量（最高优先级）
2. 根据 `NODE_ENV` 的默认配置
3. 开发环境默认值：`http://localhost:8000/api`

## 部署说明

### 开发环境
```bash
npm run dev
```

### 生产环境
```bash
# 设置生产环境变量
export NEXT_PUBLIC_API_BASE_URL=https://your-production-domain.com/api
export NODE_ENV=production

# 构建和启动
npm run build
npm start
```

### Docker部署
```dockerfile
# 在Dockerfile中设置环境变量
ENV NEXT_PUBLIC_API_BASE_URL=https://your-production-domain.com/api
ENV NODE_ENV=production
```

## 注意事项

1. 所有以 `NEXT_PUBLIC_` 开头的环境变量都会在客户端可用
2. 修改环境变量后需要重启开发服务器
3. 生产环境部署时请确保API地址正确配置
4. 建议在CI/CD流程中自动设置正确的环境变量

## 已更新的文件

以下文件已更新为使用环境配置：

- `src/config/environment.ts` - 环境配置文件
- `src/services/api.ts` - API服务文件
- `src/contexts/AuthContext.tsx` - 认证上下文
- `src/components/Header.tsx` - 头部组件
- `src/components/DccBindModal.tsx` - DCC绑定模态框

现在所有API调用都使用统一的环境配置，便于在不同环境间切换。 
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4224:function(e,t,s){Promise.resolve().then(s.bind(s,6633))},6633:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return B}});var l=s(7437),a=s(29),r=s.n(a),n=s(2265),i=s(9376),c=s(9855),o=s(8223),d=s(7342);function x(e){let{isOpen:t,onClose:s,onConfirm:a,dccUser:r}=e,[i,c]=(0,n.useState)(!1),o=async()=>{c(!0);try{await a()}finally{c(!1)}};return t?(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl p-6 shadow-2xl max-w-md w-full mx-4",children:[(0,l.jsxs)("div",{className:"text-center mb-6",children:[(0,l.jsx)("div",{className:"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,l.jsx)("svg",{className:"w-8 h-8 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,l.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:"确认解绑DCC账号"}),(0,l.jsxs)("p",{className:"text-gray-300 text-sm",children:["您确定要解绑DCC账号 ",(0,l.jsx)("span",{className:"font-medium text-blue-300",children:r})," 吗？"]}),(0,l.jsx)("p",{className:"text-gray-400 text-xs mt-2",children:"解绑后，您需要重新绑定DCC账号才能使用系统功能。"})]}),(0,l.jsxs)("div",{className:"flex space-x-3",children:[(0,l.jsx)("button",{onClick:s,disabled:i,className:"flex-1 py-2 px-4 bg-gray-600/50 hover:bg-gray-500/50 text-white font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500/50 disabled:opacity-50 disabled:cursor-not-allowed",children:"取消"}),(0,l.jsx)("button",{onClick:o,disabled:i,className:"flex-1 py-2 px-4 bg-red-600 hover:bg-red-500 text-white font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-500/50 disabled:opacity-50 disabled:cursor-not-allowed",children:i?(0,l.jsxs)("div",{className:"flex items-center justify-center",children:[(0,l.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"解绑中..."]}):"确认解绑"})]})]})}):null}var u=s(3081);function m(){var e,t;(0,i.useRouter)();let{user:s,logout:a}=(0,c.a)(),[r,o]=(0,n.useState)(!1),[d,m]=(0,n.useState)(!1),h=async()=>{try{let e=localStorage.getItem("access_token"),t=await fetch("".concat(u.CT,"/dcc/disassociate"),{method:"DELETE",headers:{"access-token":e||""}});if(!t.ok)throw Error("解绑失败");let s=await t.json();if("success"===s.status){let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);t.dcc_user=null,localStorage.setItem("user",JSON.stringify(t))}sessionStorage.setItem("needBindDcc","true"),m(!1),window.location.reload()}else throw Error(s.message||"解绑失败")}catch(e){console.error("Unbind error:",e),alert("解绑失败，请重试")}};return(0,l.jsxs)("header",{className:"sticky top-0 z-50 backdrop-blur-xl bg-white/10 border-b border-white/20",children:[(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-6 py-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg flex items-center justify-center",children:(0,l.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,l.jsx)("h1",{className:"text-xl font-semibold text-white",children:"DCC 数字员工"})]}),(0,l.jsx)("div",{className:"flex items-center space-x-4",children:(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("button",{onClick:()=>{o(!r)},className:"flex items-center space-x-2 p-2 rounded-lg transition-colors duration-200 text-gray-300 hover:text-white hover:bg-white/10",children:[(0,l.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-sm font-medium text-white",children:(null==s?void 0:null===(t=s.username)||void 0===t?void 0:null===(e=t.charAt(0))||void 0===e?void 0:e.toUpperCase())||"U"})}),(0,l.jsx)("span",{className:"text-sm font-medium",children:(null==s?void 0:s.username)||"用户"}),(0,l.jsx)("svg",{className:"w-4 h-4 transition-transform duration-200 ".concat(r?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),r&&(0,l.jsxs)("div",{className:"absolute right-0 mt-2 w-56 rounded-lg shadow-lg py-1 backdrop-blur-xl bg-white/80 border border-white/30",children:[(null==s?void 0:s.dcc_user)&&(0,l.jsxs)("div",{className:"px-4 py-3 border-b border-gray-200",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,l.jsx)("svg",{className:"w-4 h-4 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),(0,l.jsx)("span",{className:"text-xs text-gray-600",children:"DCC账号"})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-blue-600 truncate",children:s.dcc_user}),(0,l.jsx)("button",{onClick:()=>{m(!0),o(!1)},className:"ml-2 px-2 py-1 text-xs bg-red-600 hover:bg-red-700 text-white rounded transition-colors duration-200",children:"解绑"})]})]}),(0,l.jsxs)("div",{className:"px-4 py-2 border-b border-gray-200",children:[(0,l.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"用户名"}),(0,l.jsx)("div",{className:"text-sm font-medium text-gray-800",children:(null==s?void 0:s.username)||"未知用户"})]}),(0,l.jsx)("button",{onClick:()=>{a()},className:"block w-full text-left px-4 py-2 text-sm transition-colors duration-200 text-gray-700 hover:text-gray-900 hover:bg-gray-100",children:"退出登录"})]})]})})]})}),(0,l.jsx)(x,{isOpen:d,onClose:()=>m(!1),onConfirm:h,dccUser:(null==s?void 0:s.dcc_user)||""})]})}function h(e){let{isOpen:t,onClose:s,records:a,currentTasks:r=[]}=e,n=e=>{switch(e){case"success":return"text-green-400 bg-green-500/20";case"failed":return"text-red-400 bg-red-500/20";case"no-answer":return"text-yellow-400 bg-yellow-500/20";case"busy":return"text-orange-400 bg-orange-500/20";default:return"text-gray-400 bg-gray-500/20"}},i=e=>{switch(e){case"success":return"接通成功";case"failed":return"拨打失败";case"no-answer":return"无人接听";case"busy":return"占线";default:return"未知状态"}};return(0,l.jsxs)(l.Fragment,{children:[t&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40",onClick:s}),(0,l.jsx)("div",{className:"\n        fixed top-0 right-0 h-full w-[600px] bg-white/10 backdrop-blur-xl border-l border-white/20\n        transform transition-transform duration-300 ease-in-out z-50\n        ".concat(t?"translate-x-0":"translate-x-full","\n      "),children:(0,l.jsxs)("div",{className:"h-full flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-white/10",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-white",children:"电话拨打记录"}),(0,l.jsxs)("p",{className:"text-gray-400 text-sm mt-1",children:["共 ",a.length," 条记录"]})]}),(0,l.jsx)("button",{onClick:s,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:(0,l.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[r.filter(e=>"calling"===e.status).length>0&&(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("h3",{className:"text-lg font-semibold text-white mb-3 flex items-center",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2 animate-pulse"}),"正在拨打"]}),(0,l.jsx)("div",{className:"space-y-3",children:r.filter(e=>"calling"===e.status).map(e=>(0,l.jsxs)("div",{className:"bg-blue-500/10 rounded-xl p-4 border border-blue-500/20",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("span",{className:"text-white font-medium",children:e.leadName}),(0,l.jsx)("span",{className:"text-blue-400 text-sm",children:"通话中..."})]}),(0,l.jsx)("div",{className:"text-gray-300 text-sm mb-3",children:(0,l.jsxs)("div",{children:["手机号: ",e.phone]})}),(0,l.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-1.5 overflow-hidden",children:(0,l.jsx)("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all duration-300",style:{width:"".concat(e.progress,"%")}})}),(0,l.jsxs)("div",{className:"text-blue-400 text-xs mt-1 text-center",children:[e.progress,"% 完成"]})]},e.id))})]}),r.filter(e=>"pending"===e.status).length>0&&(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("h3",{className:"text-lg font-semibold text-white mb-3 flex items-center",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full mr-2"}),"等待拨打"]}),(0,l.jsxs)("div",{className:"space-y-2",children:[r.filter(e=>"pending"===e.status).slice(0,3).map(e=>(0,l.jsxs)("div",{className:"bg-gray-500/10 rounded-lg p-3 border border-gray-500/20",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-white text-sm",children:e.leadName}),(0,l.jsx)("span",{className:"text-gray-400 text-xs",children:"等待中"})]}),(0,l.jsx)("div",{className:"text-gray-400 text-xs mt-1",children:e.phone})]},e.id)),r.filter(e=>"pending"===e.status).length>3&&(0,l.jsxs)("div",{className:"text-gray-400 text-xs text-center py-2",children:["还有 ",r.filter(e=>"pending"===e.status).length-3," 个等待拨打"]})]})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[a.length>0&&(0,l.jsxs)("h3",{className:"text-lg font-semibold text-white mb-3 flex items-center",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full mr-2"}),"通话记录"]}),a.map(e=>(0,l.jsx)("div",{className:"bg-white/5 rounded-xl p-4 border border-white/10",children:(0,l.jsx)("div",{className:"flex items-start justify-between mb-3",children:(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("span",{className:"text-white font-medium text-lg",children:e.leadName}),(0,l.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(n(e.status)),children:i(e.status)})]}),(0,l.jsxs)("div",{className:"text-gray-300 text-sm space-y-1",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"text-gray-400 w-16",children:"手机号:"}),(0,l.jsx)("span",{children:e.phone})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"text-gray-400 w-16",children:"拨打时间:"}),(0,l.jsx)("span",{children:e.callTime})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"text-gray-400 w-16",children:"通话时长:"}),(0,l.jsx)("span",{className:"text-blue-300",children:e.duration})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"text-gray-400 w-16",children:"通话结果:"}),(0,l.jsx)("span",{children:e.result})]}),e.notes&&(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("span",{className:"text-gray-400 w-16 mt-1",children:"备注:"}),(0,l.jsx)("span",{className:"text-gray-300 flex-1",children:e.notes})]})]})]})})},e.id))]})]})]})})]})}function p(e){let{isOpen:t,onClose:s,onBindSuccess:a}=e,[r,i]=(0,n.useState)(1),[c,o]=(0,n.useState)(""),[d,x]=(0,n.useState)(""),[m,h]=(0,n.useState)(""),[p,g]=(0,n.useState)(""),[b,j]=(0,n.useState)(""),[f,v]=(0,n.useState)(!1),[N,y]=(0,n.useState)(0),[w,_]=(0,n.useState)(!1),k=()=>{let e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",t="";for(let s=0;s<4;s++){let s=Math.floor(Math.random()*e.length);t+=e[s]}g(t)};(0,n.useEffect)(()=>{t&&1===r&&k()},[t,r]),(0,n.useEffect)(()=>{if(2===r&&w){let e=setInterval(()=>{y(t=>t>=100?(clearInterval(e),_(!1),100):t+15*Math.random())},1e3);return()=>clearInterval(e)}},[r,w]);let C=async e=>{if(e.preventDefault(),j(""),!c||!d){j("请输入DCC用户名和密码");return}if(!m){j("请输入验证码");return}if(m!==p){j("验证码错误"),k(),h("");return}v(!0);try{let e=await fetch("".concat(u.CT,"/dcc/user/verify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_name:c,user_password:d,user_org_id:"M0BFYPL"})});if(!e.ok)throw Error("验证失败");let t=await e.json();if("success"!==t.status)throw Error(t.message||"DCC账号验证失败");let s=localStorage.getItem("access_token"),l=await fetch("".concat(u.CT,"/dcc/associate"),{method:"POST",headers:{"Content-Type":"application/json","access-token":s||""},body:JSON.stringify({dcc_user:c,dcc_user_org_id:"M0BFYPL"})});if(!l.ok)throw Error("关联失败");let a=await l.json();if("success"===a.status){let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);t.dcc_user=c,t.dcc_user_org_id="M0BFYPL",localStorage.setItem("user",JSON.stringify(t))}i(2),y(0),_(!0)}else throw Error(a.message||"关联失败")}catch(e){j(e instanceof Error?e.message:"绑定失败，请重试"),console.error("Bind error:",e)}finally{v(!1)}};return t?(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 ".concat(2===r&&w?"pointer-events-none":""),onClick:2===r&&w?void 0:s,children:(0,l.jsx)("div",{className:"bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl p-8 shadow-2xl max-w-md w-full mx-4",onClick:e=>e.stopPropagation(),children:1===r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"text-center mb-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"绑定DCC账号"}),(0,l.jsx)("p",{className:"text-gray-300",children:"请绑定您的DCC账号以继续使用系统"})]}),b&&(0,l.jsx)("div",{className:"mb-6 p-4 bg-red-900/20 border border-red-500/30 rounded-lg",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("svg",{className:"w-5 h-5 text-red-400 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsx)("div",{className:"ml-3",children:(0,l.jsx)("p",{className:"text-sm text-red-200",children:b})})]})}),(0,l.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"dcc-username",className:"block text-sm font-medium mb-2 text-gray-300",children:"DCC用户名"}),(0,l.jsx)("input",{type:"text",id:"dcc-username",value:c,onChange:e=>o(e.target.value),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200",placeholder:"请输入DCC用户名",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"dcc-password",className:"block text-sm font-medium mb-2 text-gray-300",children:"DCC密码"}),(0,l.jsx)("input",{type:"password",id:"dcc-password",value:d,onChange:e=>x(e.target.value),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200",placeholder:"请输入DCC密码",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"dcc-captcha",className:"block text-sm font-medium mb-2 text-gray-300",children:"验证码"}),(0,l.jsxs)("div",{className:"flex space-x-3",children:[(0,l.jsx)("input",{type:"text",id:"dcc-captcha",value:m,onChange:e=>h(e.target.value.toUpperCase()),className:"flex-1 px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent transition-all duration-200",placeholder:"请输入验证码",maxLength:4,required:!0}),(0,l.jsx)("button",{type:"button",onClick:k,className:"w-24 h-11 rounded-lg border border-blue-500/30 font-mono text-lg font-bold transition-all duration-200 flex items-center justify-center tracking-wider bg-gradient-to-r from-blue-600/50 to-purple-600/50 text-blue-300 hover:from-blue-500/70 hover:to-purple-500/70 hover:text-white",title:"点击刷新验证码",children:p})]})]}),(0,l.jsx)("button",{type:"submit",disabled:f,className:"w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-medium rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500/50 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:f?(0,l.jsxs)("div",{className:"flex items-center justify-center",children:[(0,l.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"绑定中..."]}):"绑定"})]})]}):(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"正在分析"}),(0,l.jsx)("p",{className:"text-gray-300",children:"系统正在分析您的DCC账号信息"})]}),N<100?(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsxs)("div",{className:"relative w-32 h-32 mx-auto mb-4",children:[(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,l.jsxs)("svg",{className:"w-16 h-16 text-blue-400 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,l.jsxs)("svg",{className:"w-8 h-8 text-purple-400 animate-spin",style:{animationDirection:"reverse"},fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"6",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]}),(0,l.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-4",children:(0,l.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-1000",style:{width:"".concat(Math.min(N,100),"%")}})}),(0,l.jsx)("p",{className:"text-gray-300 text-sm",children:"正在分析中..."})]}):(0,l.jsx)("div",{className:"mb-8",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"inline-flex items-center justify-center w-32 h-32 bg-green-500/20 rounded-full mb-6",children:(0,l.jsx)("svg",{className:"w-16 h-16 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),(0,l.jsx)("h3",{className:"text-xl font-bold text-green-400 mb-2",children:"分析完成"}),(0,l.jsx)("p",{className:"text-gray-300 text-sm",children:"DCC账号信息分析成功"})]})}),N>=100&&(0,l.jsx)("button",{onClick:()=>{let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);t.dcc_user=c,t.dcc_user_org_id="M0BFYPL",localStorage.setItem("user",JSON.stringify(t))}a&&a(),setTimeout(()=>{s(),i(1),y(0),o(""),x(""),h(""),j("")},1500)},className:"w-full py-3 px-4 bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-500 hover:to-blue-500 text-white font-medium rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500/50",children:"开始使用"})]})})}):null}var g=s(9520);function b(e){let{isOpen:t,onClose:s,onTaskCreated:a}=e,[r,i]=(0,n.useState)("select_condition"),[c,d]=(0,n.useState)([]),[x,u]=(0,n.useState)(null),[m,h]=(0,n.useState)(0),[p,b]=(0,n.useState)({startTime:null,endTime:null}),[j,f]=(0,n.useState)(!1),[v,N]=(0,n.useState)(0),[y,w]=(0,n.useState)(!1),[_,k]=(0,n.useState)(!1),[C,S]=(0,n.useState)([]),[M,L]=(0,n.useState)(!0),[T,D]=(0,n.useState)("发起任务-"),[I,z]=(0,n.useState)(null);(0,n.useEffect)(()=>{t&&(L(!0),S([{id:"1",type:"car_model",label:"选择产品",value:"",options:[]},{id:"2",type:"customer_level",label:"选择客户等级",value:"",options:[]},{id:"3",type:"visit_status",label:"选择是否到店",value:"",options:[]},{id:"4",type:"last_follow_time",label:"选择最近跟进时间",value:"",options:[{value:"today",label:"今天",count:0},{value:"yesterday",label:"昨天",count:0},{value:"this_week",label:"本周",count:0},{value:"last_week",label:"上周",count:0},{value:"this_month",label:"本月",count:0},{value:"last_month",label:"上月",count:0},{value:"custom",label:"自定义时间",count:0}],hasCustom:!0},{id:"5",type:"first_follow_time",label:"选择首次跟进时间",value:"",options:[{value:"today",label:"今天",count:0},{value:"yesterday",label:"昨天",count:0},{value:"this_week",label:"本周",count:0},{value:"last_week",label:"上周",count:0},{value:"this_month",label:"本月",count:0},{value:"last_month",label:"上月",count:0},{value:"custom",label:"自定义时间",count:0}],hasCustom:!0},{id:"6",type:"next_follow_time",label:"选择下次跟进时间",value:"",options:[{value:"today",label:"今天",count:0},{value:"yesterday",label:"昨天",count:0},{value:"this_week",label:"本周",count:0},{value:"last_week",label:"上周",count:0},{value:"this_month",label:"本月",count:0},{value:"last_month",label:"上月",count:0},{value:"custom",label:"自定义时间",count:0}],hasCustom:!0}]),(async()=>{try{let e=await o.LM.getFilteredCount({},"product");"success"===e.status&&e.data&&S(t=>t.map(t=>{if("car_model"===t.type){var s;let l=Array.isArray(e.data)?e.data.map(e=>({value:e.category,label:e.category,count:e.count})):(null===(s=e.data.by_product)||void 0===s?void 0:s.map(e=>({value:e.category,label:e.category,count:e.count})))||[];return{...t,options:l}}return t}));let t=await o.LM.getFilteredCount({},"type");"success"===t.status&&t.data&&S(e=>e.map(e=>{if("customer_level"===e.type){var s;let l=Array.isArray(t.data)?t.data.map(e=>({value:e.category,label:e.category,count:e.count})):(null===(s=t.data.by_type)||void 0===s?void 0:s.map(e=>({value:e.category,label:e.category,count:e.count})))||[];return{...e,options:l}}return e}));let s=await o.LM.getFilteredCount({},"arrive");"success"===s.status&&s.data&&S(e=>e.map(e=>{if("visit_status"===e.type){var t;let l=Array.isArray(s.data)?s.data.map(e=>{let t=e.category;return{value:"已到店"===e.category?"visited":"未到店"===e.category?"not_visited":e.category.toLowerCase().replace(/\s+/g,"_"),label:t,count:e.count}}):(null===(t=s.data.by_arrive)||void 0===t?void 0:t.map(e=>{let t=e.category;return{value:"已到店"===e.category?"visited":"未到店"===e.category?"not_visited":e.category.toLowerCase().replace(/\s+/g,"_"),label:t,count:e.count}}))||[];return{...e,options:l}}return e}))}catch(e){console.error("获取初始数据失败:",e)}finally{L(!1)}})())},[t]),(0,n.useEffect)(()=>{D(F(c))},[c]),(0,n.useEffect)(()=>{let e=async()=>{if(c.length>0){w(!0);try{let e=P(c);console.log("构建的筛选参数:",e);let t=c.some(e=>"last_follow_time"===e.type||"first_follow_time"===e.type||"next_follow_time"===e.type)?void 0:"both";console.log("使用的filterBy:",t);let s=await o.LM.getFilteredCount(e,t);if(console.log("API返回结果:",s),"success"===s.status){if(s.data&&void 0!==s.data.total_count)N(s.data.total_count);else if(Array.isArray(s.data)){let e=s.data.reduce((e,t)=>e+t.count,0);N(e)}else if(s.data.by_product||s.data.by_type){let e=0;s.data.by_product?e=s.data.by_product.reduce((e,t)=>e+t.count,0):s.data.by_type&&(e=s.data.by_type.reduce((e,t)=>e+t.count,0)),N(e)}else N(0)}else N(0)}catch(e){console.error("计算筛选数量失败:",e),N(c.reduce((e,t)=>{let s=t.options.find(e=>e.value===t.value);return e+((null==s?void 0:s.count)||0)},0))}finally{w(!1)}}else N(0)};e();let t=()=>{e()};return window.addEventListener("filterChanged",t),()=>{window.removeEventListener("filterChanged",t)}},[c]);let A=async e=>{let t;u(e),f(!1),b({startTime:null,endTime:null}),k(!0),c.find(t=>t.id===e.id);let s=P(c);if("car_model"===e.type)t="product";else if("customer_level"===e.type)t="type";else if("visit_status"===e.type)t="arrive";else if("last_follow_time"===e.type||"first_follow_time"===e.type||"next_follow_time"===e.type){let t={...e},s=c.find(t=>t.id===e.id);s&&(t.value=s.value),u(t),k(!1);return}try{let l=await o.LM.getFilteredCount(s,t||void 0);if("success"===l.status&&l.data){console.log("API返回数据:",l.data);let t=(e,t,s)=>{if(console.log("updateOptionsWithCount 被调用:",{conditionType:s,apiData:t,options:e}),"car_model"===s){if(Array.isArray(t))return console.log("处理车型数组格式:",t),e.map(e=>{let s=t.find(t=>t.category===e.value);return{...e,count:(null==s?void 0:s.count)||0}});if(t.by_product)return e.map(e=>{var s;return{...e,count:(null===(s=t.by_product.find(t=>t.category===e.value))||void 0===s?void 0:s.count)||0}})}else if("customer_level"===s){if(Array.isArray(t))return console.log("处理客户等级数组格式:",t),e.map(e=>{let s=t.find(t=>t.category===e.value);return{...e,count:(null==s?void 0:s.count)||0}});if(t.by_type)return e.map(e=>{var s;return{...e,count:(null===(s=t.by_type.find(t=>t.category===e.value))||void 0===s?void 0:s.count)||0}})}else if("visit_status"===s){if(Array.isArray(t))return console.log("处理是否到店数组格式:",t),t.map(e=>{let t=e.category;return{value:"已到店"===e.category?"visited":"未到店"===e.category?"not_visited":e.category.toLowerCase().replace(/\s+/g,"_"),label:t,count:e.count}});if(t.by_arrive)return t.by_arrive.map(e=>{let t=e.category;return{value:"已到店"===e.category?"visited":"未到店"===e.category?"not_visited":e.category.toLowerCase().replace(/\s+/g,"_"),label:t,count:e.count}})}else if("last_follow_time"===s||"first_follow_time"===s||"next_follow_time"===s){let s=t.total_count||0;return e.map(t=>({...t,count:"custom"===t.value?0:Math.floor(s/(e.length-1))}))}return e};S(s=>s.map(s=>s.id===e.id?{...s,options:t(s.options,l.data,e.type)}:s));let s={...e,options:t(e.options,l.data,e.type)},a=c.find(t=>t.id===e.id);a&&(s.value=a.value),u(s)}}catch(e){console.error("获取筛选条件选项数量失败:",e)}finally{k(!1)}},B=async e=>{if(!x)return;if("custom"===e&&x.hasCustom){f(!0);return}let t=c.findIndex(e=>e.id===x.id);if(-1!==t){let s=c[t],l=e;if(s.value.includes(",")){let t=s.value.split(",");if(t.includes(e)){let s=t.filter(t=>t!==e);l=s.length>0?s.join(","):""}else l=s.value+","+e}else l=s.value===e?"":s.value+","+e;let a=[...c];""===l?a.splice(t,1):a[t]={...x,value:l},d(a),("last_follow_time"===x.type||"first_follow_time"===x.type||"next_follow_time"===x.type)&&setTimeout(()=>{let e=new Event("filterChanged");window.dispatchEvent(e)},100)}else d([...c,{...x,value:e}]),("last_follow_time"===x.type||"first_follow_time"===x.type||"next_follow_time"===x.type)&&setTimeout(()=>{let e=new Event("filterChanged");window.dispatchEvent(e)},100)},E=async e=>{let t=c.filter(t=>t.id!==e);d(t),S(e=>e.map(e=>t.some(t=>t.id===e.id)?e:{...e,options:e.options.map(e=>({...e,count:0}))})),(null==x?void 0:x.id)===e&&u(null)},W=async()=>{i("creating_task"),h(0);try{let e=P(c);console.log("构建的筛选条件数据:",e),console.log("选中的条件:",c),c.forEach((e,t)=>{console.log("条件 ".concat(t+1,":"),{id:e.id,type:e.type,label:e.label,value:e.value,options:e.options})});let t={task_name:T,script_id:"",size_desc:e};console.log("提交的API数据:",t);let s=await o.Md.createCallTask(t),l=setInterval(()=>{h(e=>{if(e>=100){clearInterval(l),i("task_complete");let e={id:s.data.task_id,name:s.data.task_name,conditions:c,filteredCount:s.data.leads_count,filters:P(c),organization_id:s.data.organization_id,create_name:s.data.create_name,script_id:"",selectedScene:null,apiResponse:s};return z(e),a&&setTimeout(()=>{a(e)},0),100}return e+10})},200)}catch(e){console.error("创建任务失败:",e),i("select_condition"),alert("创建任务失败，请重试")}},O=()=>{i("select_condition"),d([]),u(null),h(0),f(!1),b({startTime:null,endTime:null}),D("发起任务-"),z(null),s()},F=e=>{if(0===e.length)return"发起任务-";let t=e.map(e=>{if(e.value.startsWith("custom:")){let[t,s]=e.value.replace("custom:","").split("_");return t&&s?"".concat(t,"至").concat(s):t?"从".concat(t,"开始"):s?"到".concat(s,"结束"):"自定义时间"}if("last_follow_time"===e.type||"first_follow_time"===e.type||"next_follow_time"===e.type){if(e.value.includes(","))return e.value.split(",").map(t=>{let s=H(t);if(s)return"".concat(s.start,"至").concat(s.end);{let s=e.options.find(e=>e.value===t);return(null==s?void 0:s.label)||t}}).join("；");{let t=H(e.value);if(t)return"".concat(t.start,"至").concat(t.end);{let t=e.options.find(t=>t.value===e.value);return(null==t?void 0:t.label)||""}}}if(e.value.includes(","))return e.value.split(",").map(t=>{var s;return(null===(s=e.options.find(e=>e.value===t))||void 0===s?void 0:s.label)||t}).join("、");{let t=e.options.find(t=>t.value===e.value);return(null==t?void 0:t.label)||""}});return"发起任务-".concat(t.join("、"))},H=e=>{let t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate());switch(e){case"today":return{start:s.toISOString().split("T")[0],end:s.toISOString().split("T")[0]};case"yesterday":let l=new Date(t);l.setDate(l.getDate()-1);let a=new Date(l.getFullYear(),l.getMonth(),l.getDate());return{start:a.toISOString().split("T")[0],end:a.toISOString().split("T")[0]};case"this_week":let r=new Date(t);r.setDate(t.getDate()-t.getDay());let n=new Date(r);return n.setDate(r.getDate()+6),{start:r.toISOString().split("T")[0],end:n.toISOString().split("T")[0]};case"last_week":let i=new Date(t);i.setDate(t.getDate()-t.getDay()-7);let c=new Date(i);return c.setDate(i.getDate()+6),{start:i.toISOString().split("T")[0],end:c.toISOString().split("T")[0]};case"this_month":let o=new Date(t.getFullYear(),t.getMonth(),1),d=new Date(t.getFullYear(),t.getMonth()+1,0);return{start:o.toISOString().split("T")[0],end:d.toISOString().split("T")[0]};case"last_month":let x=new Date(t.getFullYear(),t.getMonth()-1,1),u=new Date(t.getFullYear(),t.getMonth(),0);return{start:x.toISOString().split("T")[0],end:u.toISOString().split("T")[0]};case"next_week":let m=new Date(t);m.setDate(t.getDate()-t.getDay()+7);let h=new Date(m);return h.setDate(m.getDate()+6),{start:m.toISOString().split("T")[0],end:h.toISOString().split("T")[0]};case"next_month":let p=new Date(t.getFullYear(),t.getMonth()+1,1),g=new Date(t.getFullYear(),t.getMonth()+2,0);return{start:p.toISOString().split("T")[0],end:g.toISOString().split("T")[0]};default:return null}},P=e=>{let t={leads_type:[],leads_product:[]};return console.log("buildCurrentFilters 开始处理条件:",e),e.forEach(e=>{if(console.log("处理条件:",e),e.value&&""!==e.value){if(e.value.startsWith("custom:")){console.log("处理自定义时间条件:",e);let[s,l]=e.value.replace("custom:","").split("_");"first_follow_time"===e.type?(s&&(t.first_follow_start=s),l&&(t.first_follow_end=l)):"last_follow_time"===e.type?(s&&(t.latest_follow_start=s),l&&(t.latest_follow_end=l)):"next_follow_time"===e.type&&(s&&(t.next_follow_start=s),l&&(t.next_follow_end=l)),console.log("自定义时间处理结果:",{startTime:s,endTime:l,filters:t})}else if("car_model"===e.type)e.value.includes(",")?t.leads_product=e.value.split(","):t.leads_product=[e.value];else if("customer_level"===e.type)e.value.includes(",")?t.leads_type=e.value.split(","):t.leads_type=[e.value];else if("visit_status"===e.type){if(e.value.includes(",")){let s=e.value.split(","),l=[];s.forEach(e=>{if("visited"===e||"1"===e)l.push(1);else if("not_visited"===e||"0"===e)l.push(0);else{let t=parseInt(e);isNaN(t)||l.push(t)}}),l.length>0&&(t.is_arrive=l)}else if("visited"===e.value||"1"===e.value)t.is_arrive=[1];else if("not_visited"===e.value||"0"===e.value)t.is_arrive=[0];else{let s=parseInt(e.value);isNaN(s)||(t.is_arrive=[s])}}else if("last_follow_time"===e.type||"first_follow_time"===e.type||"next_follow_time"===e.type){if(console.log("处理预设时间条件:",e),e.value.includes(",")){let s=e.value.split(",");console.log("多选时间值:",s);let l=[];if(s.forEach(e=>{let t=H(e);console.log("时间值:",e,"对应时间范围:",t),t&&l.push(t)}),l.length>0){let s=l.map(e=>"".concat(e.start,"_").concat(e.end));if("first_follow_time"===e.type){t.first_follow_ranges=s;let e=l.reduce((e,t)=>t.start<e.start?t:e).start,a=l.reduce((e,t)=>t.end>e.end?t:e).end;t.first_follow_start=e,t.first_follow_end=a}else if("last_follow_time"===e.type){t.latest_follow_ranges=s;let e=l.reduce((e,t)=>t.start<e.start?t:e).start,a=l.reduce((e,t)=>t.end>e.end?t:e).end;t.latest_follow_start=e,t.latest_follow_end=a}else if("next_follow_time"===e.type){t.next_follow_ranges=s;let e=l.reduce((e,t)=>t.start<e.start?t:e).start,a=l.reduce((e,t)=>t.end>e.end?t:e).end;t.next_follow_start=e,t.next_follow_end=a}console.log("多选时间处理结果:",{timeRanges:l,timeRangeStrings:s,earliestStart:t["".concat("first_follow_time"===e.type?"first":"last_follow_time"===e.type?"latest":"next","_follow_start")],latestEnd:t["".concat("first_follow_time"===e.type?"first":"last_follow_time"===e.type?"latest":"next","_follow_end")]})}}else{console.log("单选时间值:",e.value);let s=H(e.value);console.log("单选时间范围:",s),s&&("first_follow_time"===e.type?(t.first_follow_start=s.start,t.first_follow_end=s.end):"last_follow_time"===e.type?(t.latest_follow_start=s.start,t.latest_follow_end=s.end):"next_follow_time"===e.type&&(t.next_follow_start=s.start,t.next_follow_end=s.end))}}}}),console.log("buildCurrentFilters 最终结果:",t),t};return t?(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-start justify-center z-50 pt-4",onClick:s,children:(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl max-w-7xl w-full mx-4 h-[70vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)("div",{className:"flex-1 overflow-y-auto p-6 pb-0",children:"select_condition"===r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"任务Agent - 筛选条件设置"}),(0,l.jsx)("p",{className:"text-gray-300",children:"选择筛选条件类型，逐步设置筛选条件"})]}),(0,l.jsx)("button",{onClick:O,className:"text-gray-400 hover:text-white transition-colors",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),c.length>0&&(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"任务名称"}),(0,l.jsx)("input",{type:"text",value:T,onChange:e=>D(e.target.value),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"请输入任务名称"})]}),(0,l.jsx)("h3",{className:"text-lg font-semibold text-white mb-3",children:"已设置的筛选条件"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:c.map(e=>{let t="",s="last_follow_time"===e.type||"first_follow_time"===e.type||"next_follow_time"===e.type;if(e.value.startsWith("custom:")){let[s,l]=e.value.replace("custom:","").split("_");t=s&&l?"".concat(s," 至 ").concat(l):s?"从「".concat(s,"」开始"):l?"到「".concat(l,"」结束"):"请选择时间"}else if(s){if(e.value.includes(","))t=e.value.split(",").map(t=>{let s=H(t);if(s)return"".concat(s.start," 至 ").concat(s.end);{let s=e.options.find(e=>e.value===t);return(null==s?void 0:s.label)||t}}).join("；");else{let s=H(e.value);if(s)t="".concat(s.start," 至 ").concat(s.end);else{let s=e.options.find(t=>t.value===e.value);t=(null==s?void 0:s.label)||""}}}else if(e.value.includes(","))t=e.value.split(",").map(t=>{var s;return(null===(s=e.options.find(e=>e.value===t))||void 0===s?void 0:s.label)||t}).join("、");else{let s=e.options.find(t=>t.value===e.value);t=(null==s?void 0:s.label)||""}return(0,l.jsxs)("div",{className:"flex items-center bg-blue-500/20 border border-blue-500/30 rounded-lg px-3 py-2",children:[(0,l.jsxs)("span",{className:"text-blue-300 text-sm mr-2",children:[e.label,":"]}),(0,l.jsx)("span",{className:"text-white text-sm mr-2",children:t}),(0,l.jsx)("button",{onClick:()=>E(e.id),className:"text-blue-400 hover:text-blue-300 transition-colors",children:(0,l.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]},e.id)})})]}),c.length>0&&(0,l.jsx)("div",{className:"mb-6 p-4 bg-green-500/20 border border-green-500/30 rounded-lg",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("svg",{className:"w-5 h-5 text-green-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsx)("span",{className:"text-green-200 font-medium",children:"符合条件的线索数"})]}),(0,l.jsx)("div",{className:"text-right",children:y?(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-green-400",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,l.jsx)("span",{className:"text-green-400 text-sm",children:"计算中..."})]}):(0,l.jsx)("div",{className:"text-green-400 font-bold text-lg",children:v})})]})}),(0,l.jsxs)("div",{className:"flex h-[500px]",children:[(0,l.jsxs)("div",{className:"w-1/3 pr-4 border-r border-white/10",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"筛选条件"}),(0,l.jsx)("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:C.map(e=>{let t=c.some(t=>t.id===e.id),s=(null==x?void 0:x.id)===e.id;return(0,l.jsx)("div",{onClick:()=>A(e),className:"p-3 rounded-lg cursor-pointer transition-all duration-300 ".concat(s?"bg-blue-500/30 border border-blue-500/50":t?"bg-green-500/20 border border-green-500/30":"bg-white/5 border border-white/10 hover:bg-white/10"),children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h4",{className:"font-medium text-sm ".concat(s?"text-blue-300":t?"text-green-300":"text-white"),children:e.label}),t&&(0,l.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["已设置: ",(()=>{var t;let s=c.find(t=>t.id===e.id);return s?s.value.includes(",")?s.value.split(",").map(t=>{var s;return(null===(s=e.options.find(e=>e.value===t))||void 0===s?void 0:s.label)||t}).join("、"):(null===(t=e.options.find(e=>e.value===s.value))||void 0===t?void 0:t.label)||"":""})()]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[t&&(0,l.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),(0,l.jsx)("svg",{className:"w-4 h-4 ".concat(s?"text-blue-400":"text-gray-400"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})]})]})},e.id)})})]}),(0,l.jsx)("div",{className:"flex-1 pl-4",children:x?(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,l.jsxs)("h3",{className:"text-lg font-semibold text-white",children:[x.label," 数据"]})}),_?(0,l.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-6 w-6 text-blue-400",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,l.jsx)("span",{className:"text-blue-300",children:"正在获取数据..."})]})}):(0,l.jsx)("div",{className:"space-y-3 mb-4",children:x.options.map((e,t)=>{let s="last_follow_time"===x.type||"first_follow_time"===x.type||"next_follow_time"===x.type,a=c.find(e=>e.id===x.id),r=a&&(a.value===e.value||a.value.includes(","+e.value)||a.value.startsWith(e.value+",")||a.value.endsWith(","+e.value));if(s&&"custom"!==e.value){let s=H(e.value);return(0,l.jsx)("div",{className:"border rounded-lg p-3 transition-colors cursor-pointer ".concat(r?"bg-blue-500/30 border-blue-500/50":"bg-white/5 border-white/10 hover:bg-white/10"),onClick:()=>B(e.value),children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("div",{className:"w-4 h-4 rounded border-2 flex items-center justify-center ".concat(r?"bg-blue-500 border-blue-500":"border-gray-400"),children:r&&(0,l.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-white font-medium text-sm",children:e.label}),(0,l.jsx)("p",{className:"text-gray-400 text-xs mt-1",children:s?"".concat(s.start," 至 ").concat(s.end):""})]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("div",{className:"text-blue-400 font-bold text-sm",children:"时间筛选"}),(0,l.jsx)("div",{className:"text-gray-400 text-xs",children:"选择后刷新"})]})]})},"".concat(x.id,"-").concat(e.value,"-").concat(t))}return s&&"custom"===e.value?(0,l.jsx)("div",{className:"border rounded-lg p-3 transition-colors cursor-pointer ".concat(r?"bg-blue-500/30 border-blue-500/50":"bg-white/5 border-white/10 hover:bg-white/10"),onClick:()=>B(e.value),children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("div",{className:"w-4 h-4 rounded border-2 flex items-center justify-center ".concat(r?"bg-blue-500 border-blue-500":"border-gray-400"),children:r&&(0,l.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-white font-medium text-sm",children:e.label}),(0,l.jsx)("p",{className:"text-gray-400 text-xs mt-1",children:"自定义时间范围"})]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("div",{className:"text-blue-400 font-bold text-sm",children:"时间筛选"}),(0,l.jsx)("div",{className:"text-gray-400 text-xs",children:"选择后刷新"})]})]})},"".concat(x.id,"-").concat(e.value,"-").concat(t)):(0,l.jsx)("div",{className:"border rounded-lg p-3 transition-colors cursor-pointer ".concat(r?"bg-blue-500/30 border-blue-500/50":"bg-white/5 border-white/10 hover:bg-white/10"),onClick:()=>B(e.value),children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("div",{className:"w-4 h-4 rounded border-2 flex items-center justify-center ".concat(r?"bg-blue-500 border-blue-500":"border-gray-400"),children:r&&(0,l.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-white font-medium text-sm",children:e.label}),(0,l.jsx)("p",{className:"text-gray-400 text-xs mt-1",children:"包含线索"})]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("div",{className:"text-blue-400 font-bold text-sm",children:e.count||0}),(0,l.jsx)("div",{className:"text-gray-400 text-xs",children:"线索数"})]})]})},"".concat(x.id,"-").concat(e.value,"-").concat(t))})}),j&&x&&(0,l.jsxs)("div",{className:"mt-6 p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:[(0,l.jsx)("h4",{className:"text-white font-medium mb-4",children:"自定义时间范围"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"开始时间"}),(0,l.jsx)(g.ZP,{selected:p.startTime,onChange:e=>b(t=>({...t,startTime:e})),selectsStart:!0,startDate:p.startTime||void 0,endDate:p.endTime||void 0,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholderText:"选择开始时间",dateFormat:"yyyy-MM-dd"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"结束时间"}),(0,l.jsx)(g.ZP,{selected:p.endTime,onChange:e=>b(t=>({...t,endTime:e})),selectsEnd:!0,startDate:p.startTime||void 0,endDate:p.endTime||void 0,minDate:p.startTime||void 0,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholderText:"选择结束时间",dateFormat:"yyyy-MM-dd"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,l.jsx)("button",{onClick:()=>{f(!1),b({startTime:null,endTime:null})},className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"取消"}),(0,l.jsx)("button",{onClick:()=>{let e;if(!x)return;let t="";if(p.startTime&&p.endTime){let e=p.startTime.toISOString().split("T")[0],s=p.endTime.toISOString().split("T")[0];t="custom:".concat(e,"_").concat(s)}else if(p.startTime){let e=p.startTime.toISOString().split("T")[0];t="custom:".concat(e,"_")}else{if(!p.endTime)return;let e=p.endTime.toISOString().split("T")[0];t="custom:_".concat(e)}let s={...x,value:t},l=c.findIndex(e=>e.id===x.id);-1!==l?(e=[...c])[l]=s:e=[...c,s],d(e),S(t=>t.map(t=>e.some(e=>e.id===t.id)?t:{...t,options:t.options.map(e=>({...e,count:0}))})),i("select_condition"),u(null),f(!1),b({startTime:null,endTime:null})},disabled:!p.startTime&&!p.endTime,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"确定"})]})]})]})]}):(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),(0,l.jsx)("p",{className:"text-gray-400",children:"请从左侧选择筛选条件"})]})})})]})]}):"creating_task"===r?(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"正在创建任务"}),(0,l.jsx)("p",{className:"text-gray-300",children:"系统正在处理您的筛选条件"})]}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("div",{className:"relative w-32 h-32 mx-auto mb-4",children:(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,l.jsxs)("svg",{className:"w-16 h-16 text-blue-400 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})}),(0,l.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-4",children:(0,l.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(m,"%")}})}),(0,l.jsx)("p",{className:"text-gray-300 text-sm",children:m>=100?"任务创建完成":"正在创建任务..."})]})]})}):"task_complete"===r?(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"任务创建成功！"}),(0,l.jsx)("p",{className:"text-gray-300",children:"外呼任务已创建，可以开始配置话术"})]}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("div",{className:"w-24 h-24 mx-auto mb-4 bg-green-500/20 rounded-full flex items-center justify-center",children:(0,l.jsx)("svg",{className:"w-12 h-12 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),I&&(0,l.jsxs)("div",{className:"space-y-4 text-left max-w-md mx-auto",children:[(0,l.jsxs)("div",{className:"bg-blue-500/20 border border-blue-500/30 rounded-lg p-4",children:[(0,l.jsxs)("div",{className:"flex items-center mb-2",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2 animate-pulse"}),(0,l.jsx)("span",{className:"text-blue-300 font-medium",children:"任务信息"})]}),(0,l.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-300",children:"任务ID:"}),(0,l.jsx)("span",{className:"text-white font-medium",children:I.id})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-300",children:"任务名称:"}),(0,l.jsx)("span",{className:"text-white font-medium",children:I.name})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-300",children:"线索数量:"}),(0,l.jsx)("span",{className:"text-green-400 font-bold",children:I.filteredCount})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-300",children:"创建人:"}),(0,l.jsx)("span",{className:"text-white",children:I.create_name})]})]})]}),(0,l.jsxs)("div",{className:"bg-purple-500/20 border border-purple-500/30 rounded-lg p-4",children:[(0,l.jsxs)("div",{className:"flex items-center mb-2",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-purple-400 rounded-full mr-2"}),(0,l.jsx)("span",{className:"text-purple-300 font-medium",children:"下一步"})]}),(0,l.jsx)("p",{className:"text-gray-300 text-sm",children:'点击"话术生成Agent"配置个性化话术'})]})]})]})]})}):null}),(0,l.jsxs)("div",{className:"p-6 pt-0 border-t border-white/10",children:["select_condition"===r&&(0,l.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,l.jsx)("button",{onClick:O,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"取消"}),(0,l.jsx)("button",{onClick:()=>{c.length>0?W():alert("请至少选择一个筛选条件")},disabled:0===c.length,className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-medium rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500/50 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:"创建任务"})]}),"task_complete"===r&&(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsx)("button",{onClick:O,className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-medium rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:"完成"})})]})]})}):null}s(1005),s(1478);let j={leads_product:"线索产品",leads_type:"线索等级",first_follow:"首次跟进时间区间",latest_follow:"最近跟进时间区间",next_follow:"下次跟进时间区间",first_arrive:"首次到店时间区间",is_arrive:"是否到店"};function f(e){let{isOpen:t,onClose:s,tasks:a=[],onViewTaskDetails:r}=e,[i,c]=(0,n.useState)(!1),[d,x]=(0,n.useState)(a),[u,m]=(0,n.useState)(!1),h=e=>{switch(e){case 1:return{text:"已创建",color:"bg-blue-500/20 text-blue-300"};case 2:return{text:"开始外呼",color:"bg-green-500/20 text-green-300"};case 3:return{text:"外呼完成",color:"bg-purple-500/20 text-purple-300"};case 4:return{text:"已删除",color:"bg-red-500/20 text-red-300"};default:return{text:"未知状态",color:"bg-gray-500/20 text-gray-300"}}},p=(e,t)=>{if(e&&e.length>0)return e.map((e,t)=>{if("string"==typeof e)return e;let s=e.label||e.key||"",l=e.value||e.val||"",a=j[s]||s;return"".concat(a,": ").concat(l)});if(t){let e=[],s={};return Object.entries(t).forEach(t=>{let[l,a]=t,r=j[l]||l;if(l.includes("_start")||l.includes("_end")){let e=l.replace(/_start$|_end$/,"");s[e]||(s[e]={label:j[e]||e,start:void 0,end:void 0}),l.endsWith("_start")?s[e].start=String(a):l.endsWith("_end")&&(s[e].end=String(a))}else if("is_arrive"===l){let t="1"===a||1===a||!0===a?"是":"否";e.push("".concat(r,": ").concat(t))}else e.push("".concat(r,": ").concat(String(a)))}),Object.values(s).forEach(t=>{(t.start||t.end)&&(t.start&&t.end?e.push("".concat(t.label,": ").concat(t.start," 至 ").concat(t.end)):t.start?e.push("".concat(t.label,": ").concat(t.start," 起")):t.end&&e.push("".concat(t.label,": 至 ").concat(t.end)))}),e}return[]};n.useEffect(()=>{x(a)},[a]);let g=async e=>{try{m(!0);let t=await o.Md.getCallTaskDetails(e);"success"===t.status&&t.data?null==r||r(t.data):alert("获取任务详情失败："+(t.message||"未知错误"))}catch(e){console.error("获取任务详情失败:",e),alert("获取任务详情失败，请重试")}finally{m(!1)}};return t?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-start justify-center z-50 pt-4",onClick:s,children:(0,l.jsx)("div",{className:"bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl max-w-7xl w-full mx-4 h-[70vh] flex flex-col",onClick:e=>e.stopPropagation(),children:(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 pb-0",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"任务Agent"}),(0,l.jsx)("p",{className:"text-gray-300",children:"管理和查看已创建的任务"})]}),(0,l.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-white transition-colors",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,l.jsx)("div",{className:"mb-6",children:(0,l.jsx)("button",{onClick:()=>c(!0),className:"w-full px-6 py-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-medium rounded-lg transition-all duration-200 hover:shadow-lg hover:scale-105",children:(0,l.jsxs)("div",{className:"flex items-center justify-center",children:[(0,l.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"创建新任务"]})})}),0===d.length?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"text-gray-400 mb-4",children:(0,l.jsx)("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),(0,l.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"暂无任务"}),(0,l.jsx)("p",{className:"text-gray-400",children:"点击上方按钮创建您的第一个任务"})]}):(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(e=>{let t=p(e.conditions,e.size_desc);return(0,l.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4 hover:bg-white/10 transition-colors",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsx)("h3",{className:"text-white font-medium",children:e.name}),(0,l.jsx)("div",{className:"px-2 py-1 rounded-full text-xs ".concat(h(e.task_type).color),children:h(e.task_type).text})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"text-sm text-gray-300",children:[(0,l.jsx)("span",{className:"font-medium",children:"筛选条件:"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:t.length>0?t.map((e,t)=>(0,l.jsx)("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-300 text-xs rounded",children:e},"condition-".concat(t,"-").concat(e))):(0,l.jsx)("span",{className:"text-gray-400 text-xs",children:"无筛选条件"})})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,l.jsx)("span",{className:"text-gray-300",children:"目标线索:"}),(0,l.jsx)("span",{className:"text-green-400 font-bold",children:e.filteredCount})]}),(0,l.jsxs)("div",{className:"text-xs text-gray-400",children:["创建时间: ",e.createdAt]})]}),(0,l.jsxs)("div",{className:"flex space-x-2 mt-3",children:[(0,l.jsx)("button",{onClick:()=>g(e.id),disabled:u,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 disabled:bg-gray-600 disabled:cursor-not-allowed text-white text-xs rounded transition-colors",children:u?"加载中...":"查看详情"}),(0,l.jsx)("button",{className:"px-3 py-1.5 bg-red-600 hover:bg-red-500 text-white text-xs rounded transition-colors",children:"删除"})]})]},e.id)})})]})})}),(0,l.jsx)(b,{isOpen:i,onClose:()=>c(!1),onTaskCreated:e=>{var t;let s={id:(null===(t=e.id)||void 0===t?void 0:t.toString())||"task-".concat(Date.now()),name:e.name,createdAt:new Date().toLocaleString(),conditions:e.conditions||[],filteredCount:e.filteredCount||0,status:"pending"};x(e=>[s,...e]),c(!1),console.log("任务创建完成:",e),alert("任务创建成功！\n任务ID: ".concat(e.id,"\n任务名称: ").concat(e.name,"\n线索数量: ").concat(e.filteredCount))}})]}):null}let v={leads_product:"线索产品",leads_type:"线索等级",first_follow:"首次跟进时间区间",latest_follow:"最近跟进时间区间",next_follow:"下次跟进时间区间",first_arrive:"首次到店时间区间",is_arrive:"是否到店"};function N(e){let{isOpen:t,onClose:s,onTaskSelect:a,tasks:r=[]}=e,n=e=>{switch(e){case 1:return{text:"已创建",color:"bg-blue-500/20 text-blue-300"};case 2:return{text:"开始外呼",color:"bg-green-500/20 text-green-300"};case 3:return{text:"外呼完成",color:"bg-purple-500/20 text-purple-300"};case 4:return{text:"已删除",color:"bg-red-500/20 text-red-300"};default:return{text:"未知状态",color:"bg-gray-500/20 text-gray-300"}}},i=r.filter(e=>1===e.task_type),c=(e,t)=>{if(e&&e.length>0)return e.map((e,t)=>{if("string"==typeof e)return e;let s=e.label||e.key||"",l=e.value||e.val||"",a=v[s]||s;return"".concat(a,": ").concat(l)});if(t){let e=[],s={};return Object.entries(t).forEach(t=>{let[l,a]=t;if(null===a)return;let r=v[l]||l;if(l.includes("_start")||l.includes("_end")){let e=l.replace(/_start$|_end$/,"");s[e]||(s[e]={label:v[e]||e,start:void 0,end:void 0}),l.endsWith("_start")?s[e].start=String(a):l.endsWith("_end")&&(s[e].end=String(a))}else if(l.includes("_ranges")&&Array.isArray(a)){let e=l.replace(/_ranges$/,"");s[e]||(s[e]={label:v[e]||e,ranges:[]}),s[e].ranges=a}else if("is_arrive"===l){let t="1"===a||1===a||!0===a?"是":"否";e.push("".concat(r,": ").concat(t))}else Array.isArray(a)?a.length>0&&e.push("".concat(r,": ").concat(a.join("、"))):e.push("".concat(r,": ").concat(String(a)))}),Object.values(s).forEach(t=>{if(t.ranges&&t.ranges.length>0){let s=t.ranges.map(e=>{let[t,s]=e.split("_");return"".concat(t," 至 ").concat(s)});e.push("".concat(t.label,": ").concat(s.join("、")))}else(t.start||t.end)&&(t.start&&t.end?e.push("".concat(t.label,": ").concat(t.start," 至 ").concat(t.end)):t.start?e.push("".concat(t.label,": ").concat(t.start," 起")):t.end&&e.push("".concat(t.label,": 至 ").concat(t.end)))}),e}return[]};return t?(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-start justify-center z-50 pt-4",onClick:s,children:(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl max-w-7xl w-full mx-4 h-[70vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 pb-0",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"话术生成Agent"}),(0,l.jsx)("p",{className:"text-gray-300",children:"选择已创建的任务，配置个性化话术"})]}),(0,l.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-white transition-colors",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(e=>{let t=c(e.conditions,e.size_desc);return(0,l.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4 hover:bg-white/10 transition-colors cursor-pointer",onClick:()=>a(e),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsx)("h3",{className:"text-white font-medium",children:e.name}),(0,l.jsx)("div",{className:"px-2 py-1 rounded-full text-xs ".concat(n(e.task_type).color),children:n(e.task_type).text})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"text-sm text-gray-300",children:[(0,l.jsx)("span",{className:"font-medium",children:"筛选条件:"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:t.length>0?t.map((e,t)=>(0,l.jsx)("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-300 text-xs rounded",children:e},"condition-".concat(t,"-").concat(e))):(0,l.jsx)("span",{className:"text-gray-400 text-xs",children:"无筛选条件"})})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,l.jsx)("span",{className:"text-gray-300",children:"目标线索:"}),(0,l.jsx)("span",{className:"text-green-400 font-bold",children:e.targetCount})]}),(0,l.jsxs)("div",{className:"text-xs text-gray-400",children:["创建时间: ",e.createdAt]})]})]},e.id)})}),0===i.length&&(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"text-gray-400 mb-4",children:(0,l.jsx)("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),(0,l.jsx)("p",{className:"text-gray-300 mb-2",children:"暂无已创建的任务"}),(0,l.jsx)("p",{className:"text-gray-400 text-sm",children:'请先使用"任务Agent"创建任务'})]})]}),(0,l.jsx)("div",{className:"p-6 pt-0 border-t border-white/10",children:(0,l.jsx)("div",{className:"flex justify-end space-x-3",children:(0,l.jsx)("button",{onClick:s,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"取消"})})})]})}):null}let y={leads_product:"线索产品",leads_type:"线索等级",first_follow:"首次跟进时间区间",latest_follow:"最近跟进时间区间",next_follow:"下次跟进时间区间",first_arrive:"首次到店时间区间",is_arrive:"是否到店"};function w(e){let{isOpen:t,onClose:s,selectedTask:a,onBackToTaskDetail:r,onScriptConfigured:i}=e,[c,d]=(0,n.useState)("script_config"),[x,u]=(0,n.useState)(a),[m,h]=(0,n.useState)("official_scenes"),[p,g]=(0,n.useState)({name:"",description:"",dialogue_target:"",dialogue_opening_prompt:"",dialogue_bg:"",dialogue_skill:"",dialogue_flow:"",dialogue_constraint:"",bot_name:"",bot_post:"电销专员",bot_age:"",bot_style:""}),[b,j]=(0,n.useState)([]),[f,v]=(0,n.useState)(null),[N,w]=(0,n.useState)(!1),[_,k]=(0,n.useState)(null),[C,S]=(0,n.useState)(!1),[M,L]=(0,n.useState)({customerName:"",gender:"male",age:"",company:"",position:"",industry:"",region:"",productInterest:"",budget:"",urgency:"",decisionMaker:!1,previousContact:!1,contactHistory:"",objections:"",goals:"",skills:"",painPoints:"",competitorInfo:"",referralSource:"",customNotes:""}),[T,D]=(0,n.useState)([{id:"1",name:"电销专员",description:"专业的电话销售专员"},{id:"2",name:"DCC经理",description:"数字客户中心经理"},{id:"3",name:"销售顾问",description:"专业的销售顾问"}]),[I,z]=(0,n.useState)("1"),[A,B]=(0,n.useState)(""),[E,W]=(0,n.useState)([{id:"1",name:"亲切",description:"亲切友好的沟通风格"},{id:"2",name:"自然",description:"自然流畅的沟通风格"},{id:"3",name:"口语化",description:"口语化的表达方式"},{id:"4",name:"专业",description:"专业严谨的沟通风格"},{id:"5",name:"活泼",description:"活泼开朗的沟通风格"},{id:"6",name:"严肃",description:"严肃认真的沟通风格"}]),[O,F]=(0,n.useState)([]),[H,P]=(0,n.useState)(""),[R,V]=(0,n.useState)([{id:"1",name:"专业顾问",description:"以专业知识和经验为客户提供建议"},{id:"2",name:"朋友式销售",description:"以朋友的身份与客户建立信任关系"},{id:"3",name:"问题解决者",description:"专注于解决客户的具体问题和需求"},{id:"4",name:"价值创造者",description:"帮助客户发现和创造新的价值机会"}]),[U,q]=(0,n.useState)([{id:"1",name:"正式专业",description:"使用正式的语言和专业的表达方式"},{id:"2",name:"轻松友好",description:"使用轻松友好的语言建立亲近感"},{id:"3",name:"直接简洁",description:"直接表达重点，避免冗长的描述"},{id:"4",name:"故事化",description:"通过故事和案例来传达信息"}]),[J,G]=(0,n.useState)(""),[Y,$]=(0,n.useState)(""),[Z,K]=(0,n.useState)(""),[Q,X]=(0,n.useState)(""),[ee,et]=(0,n.useState)([]),[es,el]=(0,n.useState)(0),[ea,er]=(0,n.useState)(""),en=(e,t)=>{if(e&&e.length>0)return e.map(e=>{let t=e.split(":");if(2===t.length){let e=t[0].trim(),s=t[1].trim(),l=y[e]||e;return"".concat(l,": ").concat(s)}return e});if(t){let e=[],s={};return Object.entries(t).forEach(t=>{let[l,a]=t;if(null==a||""===a)return;let r=y[l]||l;if(l.includes("_start")||l.includes("_end")){let e=l.replace(/_start$|_end$/,"");s[e]||(s[e]={label:y[e]||e,start:void 0,end:void 0}),l.endsWith("_start")?s[e].start=String(a):l.endsWith("_end")&&(s[e].end=String(a))}else if(l.includes("_ranges")&&Array.isArray(a)){let e=l.replace(/_ranges$/,"");s[e]||(s[e]={label:y[e]||e,ranges:[]}),s[e].ranges=a}else if("is_arrive"===l){let t="1"===a||1===a||!0===a?"是":"否";e.push("".concat(r,": ").concat(t))}else if(Array.isArray(a))a.length>0&&e.push("".concat(r,": ").concat(a.join("、")));else if("string"==typeof a&&a.includes(",")){let t=a.split(",").map(e=>e.trim()).filter(e=>e);t.length>0&&e.push("".concat(r,": ").concat(t.join("、")))}else e.push("".concat(r,": ").concat(String(a)))}),Object.values(s).forEach(t=>{if(t.ranges&&t.ranges.length>0){let s=t.ranges.map(e=>{let[t,s]=e.split("_");return"".concat(t," 至 ").concat(s)});e.push("".concat(t.label,": ").concat(s.join("、")))}else(t.start||t.end)&&(t.start&&t.end?e.push("".concat(t.label,": ").concat(t.start," 至 ").concat(t.end)):t.start?e.push("".concat(t.label,": ").concat(t.start," 起")):t.end&&e.push("".concat(t.label,": 至 ").concat(t.end)))}),e}return[]};(0,n.useEffect)(()=>{a&&u(a)},[a]);let ei=async()=>{w(!0),k(null);try{let e=await o.F.getScenes();"success"===e.status&&e.data?j(e.data):k("获取场景列表失败")}catch(e){k("获取场景列表失败"),console.error("获取场景列表错误:",e)}finally{w(!1)}};(0,n.useEffect)(()=>{t&&ei()},[t]);let ec=()=>{d("generating_script"),el(0);let e=setInterval(()=>{el(t=>{if(t>=100){var s,l;return clearInterval(e),d("script_complete"),i&&f&&setTimeout(()=>{i(f)},0),er("\n# 个性化话术生成结果\n\n## 场景信息\n".concat(f?"\n- 场景名称: ".concat(f.scene_name,"\n- 场景类型: ").concat(ef(f.scene_type),"\n- 机器人姓名: ").concat(f.bot_name,"\n- 机器人职位: ").concat(f.bot_post,"\n- 机器人年龄: ").concat(f.bot_age,"岁\n- 机器人风格: ").concat(f.bot_style||"未设置","\n"):"\n- 场景名称: ".concat(p.name,"\n- 场景描述: ").concat(p.description,"\n"),"\n\n## 筛选条件\n").concat(en(null==x?void 0:x.conditions,null==x?void 0:x.size_desc).map(e=>"- ".concat(e)).join("\n"),"\n\n## 销售身份\n").concat((null===(s=R.find(e=>e.id===J))||void 0===s?void 0:s.name)||"专业顾问","\n\n## 沟通风格\n").concat((null===(l=U.find(e=>e.id===Y))||void 0===l?void 0:l.name)||"正式专业","\n\n## 个性化话术\n基于您选择的场景和配置信息，我为您生成了以下个性化话术：\n\n**开场白：**\n").concat(f?f.dialogue_opening_prompt:"您好，我是[公司名称]的[姓名]。我想了解一下，您目前在这个领域遇到了哪些挑战？","\n\n**对话目标：**\n").concat(f?f.dialogue_target:"深入了解客户需求，提供合适的解决方案","\n\n**对话背景：**\n").concat(f?f.dialogue_bg:"基于客户的具体情况和需求进行个性化沟通","\n\n**对话流程：**\n").concat(f?f.dialogue_flow:"1. 开场白和自我介绍\n2. 需求挖掘和痛点分析\n3. 价值展示和方案介绍\n4. 异议处理和问题解答\n5. 成交促成和后续跟进","\n\n**对话约束：**\n").concat(f?f.dialogue_constraint:"1. 保持专业和友好的沟通态度\n2. 根据客户反应灵活调整话术内容\n3. 重点突出与客户需求相关的产品特性\n4. 准备应对常见的异议和疑问","\n\n## 关键标签\n").concat(f&&f.scene_tags?f.scene_tags.map(e=>"- ".concat(e.tag_name,": ").concat(e.tags)).join("\n"):ee.map(e=>"- ".concat(e.name,": ").concat(e.values.join(", "))).join("\n"),"\n\n## 注意事项\n1. 根据客户反应灵活调整话术内容\n2. 重点突出与客户需求相关的产品特性\n3. 准备应对常见的异议和疑问\n4. 保持专业和友好的沟通态度\n5. 遵循场景设定的对话流程和约束条件\n          ")),100}return t+15*Math.random()+5})},200)},eo=()=>{d("script_config"),el(0),er(""),h(""),S(!1),g({name:"",description:"",dialogue_target:"",dialogue_opening_prompt:"",dialogue_bg:"",dialogue_skill:"",dialogue_flow:"",dialogue_constraint:"",bot_name:"",bot_post:"电销专员",bot_age:"",bot_style:""}),z("1"),B(""),F([]),P(""),v(null),L({customerName:"",gender:"male",age:"",company:"",position:"",industry:"",region:"",productInterest:"",budget:"",urgency:"",decisionMaker:!1,previousContact:!1,contactHistory:"",objections:"",goals:"",skills:"",painPoints:"",competitorInfo:"",referralSource:"",customNotes:""}),G(""),$(""),K(""),X(""),et([]),s()},ed=e=>{z(e);let t=T.find(t=>t.id===e);t&&g(e=>({...e,bot_post:t.name}))},ex=e=>{F(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]);let t=(O.includes(e)?O.filter(t=>t!==e):[...O,e]).map(e=>{let t=E.find(t=>t.id===e);return t?t.name:""}).filter(e=>e);g(e=>({...e,bot_style:t.join("; ")}))},eu=(e,t,s)=>{et(l=>l.map(l=>l.id===e?{...l,[t]:s}:l))},em=(e,t)=>{t.trim()&&et(s=>s.map(s=>s.id===e?{...s,values:[...s.values,t.trim()]}:s))},eh=(e,t)=>{et(s=>s.map(s=>s.id===e?{...s,values:s.values.filter((e,s)=>s!==t)}:s))},ep=e=>{et(t=>t.filter(t=>t.id!==e))},eg=async()=>{let e=[];if(p.name.trim()||e.push("场景名称"),p.bot_name.trim()||e.push("机器人姓名"),p.dialogue_target.trim()||e.push("对话目的"),p.dialogue_opening_prompt.trim()||e.push("开场白"),p.dialogue_flow.trim()||e.push("对话流程"),0===ee.length&&e.push("标签组（至少添加一个标签组）"),e.length>0){alert("请填写以下必填项：\n".concat(e.join("\n")));return}try{let e={scene_name:p.name,scene_detail:p.description,scene_type:2,bot_name:p.bot_name,bot_sex:p.bot_age?1:void 0,bot_age:parseInt(p.bot_age)||void 0,bot_post:p.bot_post,bot_style:p.bot_style,dialogue_target:p.dialogue_target,dialogue_bg:p.dialogue_bg,dialogue_skill:p.dialogue_skill,dialogue_flow:p.dialogue_flow,dialogue_constraint:p.dialogue_constraint,dialogue_opening_prompt:p.dialogue_opening_prompt,scene_tags:ee.map(e=>({tag_name:e.name,tag_detail:e.description,tags:e.values.join("; ")}))},t=await o.F.createScene(e);if("success"===t.status){if(alert(C?"场景更新成功！":"自定义场景创建成功！"),C)v(e=>e?{...e,scene_name:p.name,scene_detail:p.description,dialogue_target:p.dialogue_target,dialogue_opening_prompt:p.dialogue_opening_prompt,dialogue_bg:p.dialogue_bg,dialogue_skill:p.dialogue_skill,dialogue_flow:p.dialogue_flow,dialogue_constraint:p.dialogue_constraint,bot_name:p.bot_name,bot_post:p.bot_post,bot_age:parseInt(p.bot_age)||0,bot_style:p.bot_style}:null),S(!1);else{let e={id:Date.now(),script_id:t.data.script_id,scene_name:p.name,scene_detail:p.description,scene_status:1,scene_type:2,scene_create_user_id:"",scene_create_user_name:"",scene_create_org_id:"",scene_create_time:new Date().toISOString(),bot_name:p.bot_name,bot_sex:null,bot_age:parseInt(p.bot_age)||0,bot_post:p.bot_post,bot_style:p.bot_style,dialogue_target:p.dialogue_target,dialogue_bg:p.dialogue_bg,dialogue_skill:p.dialogue_skill,dialogue_flow:p.dialogue_flow,dialogue_constraint:p.dialogue_constraint,dialogue_opening_prompt:p.dialogue_opening_prompt,scene_tags:ee.map(e=>({id:Date.now()+Math.random(),script_id:t.data.script_id,tag_name:e.name,tag_detail:e.description,tags:e.values.join("; ")}))};v(e),h("scene_selected"),g({name:"",description:"",dialogue_target:"",dialogue_opening_prompt:"",dialogue_bg:"",dialogue_skill:"",dialogue_flow:"",dialogue_constraint:"",bot_name:"",bot_post:"电销专员",bot_age:"",bot_style:""}),F([]),z("1"),et([])}}else alert("创建场景失败："+t.message)}catch(e){console.error("创建场景错误:",e),alert("创建场景失败，请重试")}},eb=e=>{v(e),h("scene_selected"),S(!1),L(t=>{var s;return{...t,customerName:e.bot_name,age:(null===(s=e.bot_age)||void 0===s?void 0:s.toString())||"",goals:e.dialogue_target,skills:e.dialogue_skill||"",customNotes:"场景背景: ".concat(e.dialogue_bg,"\n对话流程: ").concat(e.dialogue_flow,"\n对话约束: ").concat(e.dialogue_constraint)}})},ej=(e,t)=>{var s,l;t.stopPropagation();let a={scene_name:"".concat(e.scene_name," - 副本"),scene_detail:e.scene_detail,scene_type:2,bot_name:e.bot_name,bot_sex:e.bot_sex?parseInt(e.bot_sex):void 0,bot_age:e.bot_age,bot_post:e.bot_post,bot_style:e.bot_style,dialogue_target:e.dialogue_target,dialogue_bg:e.dialogue_bg,dialogue_skill:e.dialogue_skill,dialogue_flow:e.dialogue_flow,dialogue_constraint:e.dialogue_constraint,dialogue_opening_prompt:e.dialogue_opening_prompt,scene_tags:(null===(s=e.scene_tags)||void 0===s?void 0:s.map(e=>({tag_name:e.tag_name,tag_detail:e.tag_detail,tags:e.tags})))||[]},r=[];e.bot_style&&(r=e.bot_style.split(";").map(e=>e.trim()).filter(e=>e));let n=E.filter(e=>r.includes(e.name)).map(e=>e.id),i=T.find(t=>t.name===e.bot_post),c=i?i.id:"1",o=(e.scene_tags||[]).map((e,t)=>({id:"tag_".concat(t),name:e.tag_name,description:e.tag_detail,values:e.tags?e.tags.split(";").map(e=>e.trim()).filter(e=>e):[]}));g({name:a.scene_name,description:a.scene_detail,dialogue_target:a.dialogue_target,dialogue_opening_prompt:a.dialogue_opening_prompt,dialogue_bg:a.dialogue_bg,dialogue_skill:a.dialogue_skill||"",dialogue_flow:a.dialogue_flow,dialogue_constraint:a.dialogue_constraint,bot_name:a.bot_name,bot_post:a.bot_post,bot_age:(null===(l=a.bot_age)||void 0===l?void 0:l.toString())||"",bot_style:a.bot_style||""}),F(n),z(c),et(o),h("create_custom"),S(!1)},ef=e=>1===e?"官方场景":"自定义场景",ev=e=>1===e?"启用":"禁用";return t?(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-start justify-center z-50 pt-4",onClick:s,children:(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl max-w-7xl w-full mx-4 h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 pb-0",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"话术生成Agent"}),(0,l.jsx)("p",{className:"text-gray-300",children:"为任务配置个性化话术参数"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[r&&(0,l.jsx)("button",{onClick:r,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"返回任务详情"}),(0,l.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-white transition-colors",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]}),"script_config"===c&&(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"mb-6 p-4 bg-blue-500/20 border border-blue-500/30 rounded-lg",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white mb-3",children:"任务摘要"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-300",children:"筛选条件:"}),(0,l.jsx)("div",{className:"text-white mt-1",children:en(null==x?void 0:x.conditions,null==x?void 0:x.size_desc).map((e,t)=>(0,l.jsx)("div",{className:"text-sm",children:e},"condition-".concat(t,"-").concat(e)))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-300",children:"目标线索数:"}),(0,l.jsx)("div",{className:"text-white text-lg font-bold mt-1",children:null==x?void 0:x.targetCount})]})]})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("div",{className:"mb-6",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,l.jsx)("button",{onClick:()=>h("official_scenes"),className:"p-3 rounded-lg transition-all duration-300 border ".concat("official_scenes"===m?"bg-blue-500/20 border-blue-500/50 text-blue-300 shadow-lg":"bg-white/5 border-white/10 text-gray-300 hover:bg-white/10 hover:border-white/20"),children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-sm font-semibold mb-1",children:"官方场景"}),(0,l.jsx)("div",{className:"text-xs opacity-75",children:"使用预设的标准化场景"})]})}),(0,l.jsx)("button",{onClick:()=>h("custom_scenes"),className:"p-3 rounded-lg transition-all duration-300 border ".concat("custom_scenes"===m?"bg-green-500/20 border-green-500/50 text-green-300 shadow-lg":"bg-white/5 border-white/10 text-gray-300 hover:bg-white/10 hover:border-white/20"),children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-sm font-semibold mb-1",children:"自定义场景"}),(0,l.jsx)("div",{className:"text-xs opacity-75",children:"选择并编辑已有场景"})]})}),(0,l.jsx)("button",{onClick:()=>h("create_custom"),className:"p-3 rounded-lg transition-all duration-300 border ".concat("create_custom"===m?"bg-purple-500/20 border-purple-500/50 text-purple-300 shadow-lg":"bg-white/5 border-white/10 text-gray-300 hover:bg-white/10 hover:border-white/20"),children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-sm font-semibold mb-1",children:"创建新场景"}),(0,l.jsx)("div",{className:"text-xs opacity-75",children:"创建全新的个性化场景"})]})})]})}),("official_scenes"===m||"custom_scenes"===m)&&(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h4",{className:"text-lg font-semibold text-white mb-4",children:"official_scenes"===m?"官方场景列表":"自定义场景列表"}),N&&(0,l.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400"}),(0,l.jsx)("span",{className:"ml-3 text-gray-300",children:"加载场景中..."})]}),_&&(0,l.jsx)("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-4",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("svg",{className:"w-5 h-5 text-red-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsx)("span",{className:"text-red-300",children:_})]})}),!N&&!_&&(0,l.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:b.filter(e=>"official_scenes"===m?1===e.scene_type:"custom_scenes"!==m||1!==e.scene_type).map(e=>(0,l.jsxs)("div",{className:"p-4 border rounded-lg cursor-pointer transition-colors relative ".concat((null==f?void 0:f.id)===e.id?"bg-blue-500/20 border-blue-500/50":"bg-white/5 border-white/10 hover:bg-white/10"),onClick:()=>eb(e),children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,l.jsx)("h4",{className:"text-white font-medium",children:e.scene_name}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(1===e.scene_type?"bg-blue-500/20 text-blue-300":"bg-green-500/20 text-green-300"),children:ef(e.scene_type)}),(0,l.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(1===e.scene_status?"bg-green-500/20 text-green-300":"bg-red-500/20 text-red-300"),children:ev(e.scene_status)}),1===e.scene_type&&(0,l.jsx)("button",{onClick:t=>ej(e,t),className:"p-1.5 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 hover:text-blue-200 rounded-lg transition-colors",title:"复制场景",children:(0,l.jsx)("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]}),(0,l.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"机器人:"}),(0,l.jsxs)("span",{className:"text-white ml-1",children:[e.bot_name," (",e.bot_post,")"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"目标:"}),(0,l.jsx)("p",{className:"text-white mt-1 line-clamp-2",children:e.dialogue_target})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"开场白:"}),(0,l.jsx)("p",{className:"text-white mt-1 line-clamp-2",children:e.dialogue_opening_prompt})]}),e.scene_tags&&e.scene_tags.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"标签:"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.scene_tags.map((e,t)=>(0,l.jsx)("span",{className:"px-2 py-1 bg-purple-500/20 text-purple-300 text-xs rounded",children:e.tag_name},"tag-".concat(t,"-").concat(e.tag_name)))})]})]})]},e.id))}),!N&&!_&&0===b.filter(e=>"official_scenes"===m?1===e.scene_type:"custom_scenes"!==m||1!==e.scene_type).length&&(0,l.jsxs)("div",{className:"text-center py-8",children:[(0,l.jsx)("div",{className:"text-gray-400 mb-2",children:"暂无可用场景"}),(0,l.jsx)("p",{className:"text-gray-500 text-sm",children:"请选择其他类型或创建新场景"})]})]}),("create_custom"===m||C)&&(0,l.jsxs)("div",{className:"p-4 bg-purple-500/10 border border-purple-500/30 rounded-lg",children:[(0,l.jsx)("h4",{className:"text-white font-medium mb-4",children:C?"编辑场景":"创建新场景配置"}),(0,l.jsx)("div",{className:"mb-4 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:(0,l.jsxs)("p",{className:"text-yellow-300 text-sm",children:[(0,l.jsx)("span",{className:"text-red-400",children:"*"})," 为必填项，请确保填写完整"]})}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["场景名称 ",(0,l.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,l.jsx)("input",{type:"text",value:p.name,onChange:e=>g(t=>({...t,name:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"请输入场景名称"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"场景描述"}),(0,l.jsx)("input",{type:"text",value:p.description,onChange:e=>g(t=>({...t,description:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"请输入场景描述"})]})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h5",{className:"text-white font-medium mb-3",children:"机器人信息"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["机器人姓名 ",(0,l.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,l.jsx)("input",{type:"text",value:p.bot_name,onChange:e=>g(t=>({...t,bot_name:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"请输入机器人姓名"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"机器人职位"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:T.map(e=>(0,l.jsx)("button",{onClick:()=>ed(e.id),className:"px-3 py-1 rounded-full text-sm transition-colors ".concat(I===e.id?"bg-blue-500 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"),children:e.name},e.id))}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("input",{type:"text",value:A,onChange:e=>B(e.target.value),className:"flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"自定义职位"}),(0,l.jsx)("button",{onClick:()=>{if(A.trim()){let e={id:Date.now().toString(),name:A,description:"自定义机器人职位"};D(t=>[...t,e]),z(e.id),g(e=>({...e,bot_post:A})),B("")}},className:"px-3 py-2 bg-purple-500/20 text-purple-300 hover:bg-purple-500/30 rounded-lg text-sm transition-colors",children:"添加"})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"机器人年龄"}),(0,l.jsx)("input",{type:"number",value:p.bot_age,onChange:e=>g(t=>({...t,bot_age:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"请输入机器人年龄"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"机器人沟通风格"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:E.map(e=>(0,l.jsx)("button",{onClick:()=>ex(e.id),className:"px-3 py-1 rounded-full text-sm transition-colors ".concat(O.includes(e.id)?"bg-green-500 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"),children:e.name},e.id))}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("input",{type:"text",value:H,onChange:e=>P(e.target.value),className:"flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"自定义风格"}),(0,l.jsx)("button",{onClick:()=>{if(H.trim()){let e={id:Date.now().toString(),name:H,description:"自定义沟通风格"};W(t=>[...t,e]),F(t=>[...t,e.id]),g(e=>({...e,bot_style:e.bot_style?"".concat(e.bot_style,"; ").concat(H):H})),P("")}},className:"px-3 py-2 bg-purple-500/20 text-purple-300 hover:bg-purple-500/30 rounded-lg text-sm transition-colors",children:"添加"})]})]})]})]})]}),(0,l.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["对话目的 ",(0,l.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,l.jsx)("textarea",{value:p.dialogue_target,onChange:e=>g(t=>({...t,dialogue_target:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"请输入对话目的",rows:3})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["开场白 ",(0,l.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,l.jsx)("textarea",{value:p.dialogue_opening_prompt,onChange:e=>g(t=>({...t,dialogue_opening_prompt:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"请输入开场白",rows:3})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"对话场景"}),(0,l.jsx)("textarea",{value:p.dialogue_bg,onChange:e=>g(t=>({...t,dialogue_bg:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"请输入对话场景",rows:3})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"对话技能"}),(0,l.jsx)("textarea",{value:p.dialogue_skill,onChange:e=>g(t=>({...t,dialogue_skill:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"请输入对话技能",rows:3})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["对话流程 ",(0,l.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,l.jsx)("textarea",{value:p.dialogue_flow,onChange:e=>g(t=>({...t,dialogue_flow:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"请输入对话流程",rows:3})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"对话约束"}),(0,l.jsx)("textarea",{value:p.dialogue_constraint,onChange:e=>g(t=>({...t,dialogue_constraint:e.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"请输入对话约束",rows:3})]})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsxs)("h5",{className:"text-white font-medium",children:["标签组 ",(0,l.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,l.jsx)("button",{onClick:()=>{let e={id:Date.now().toString(),name:"",description:"",values:[]};et(t=>[...t,e])},className:"px-3 py-1 bg-purple-500/20 text-purple-300 hover:bg-purple-500/30 rounded-lg text-sm transition-colors",children:"+ 添加标签组"})]}),0===ee.length?(0,l.jsxs)("div",{className:"text-center py-8 bg-white/5 border border-white/10 rounded-lg",children:[(0,l.jsx)("div",{className:"text-gray-400 mb-2",children:"暂无标签组"}),(0,l.jsx)("p",{className:"text-gray-500 text-sm",children:'点击"添加标签组"按钮来创建新的标签组'})]}):(0,l.jsx)("div",{className:"space-y-4",children:ee.map(e=>(0,l.jsxs)("div",{className:"p-4 bg-white/5 border border-white/10 rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsx)("input",{type:"text",value:e.name,onChange:t=>eu(e.id,"name",t.target.value),className:"flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50 mr-2",placeholder:"标签名称"}),(0,l.jsx)("button",{onClick:()=>ep(e.id),className:"text-red-400 hover:text-red-300 transition-colors",children:(0,l.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),(0,l.jsx)("div",{className:"mb-3",children:(0,l.jsx)("input",{type:"text",value:e.description,onChange:t=>eu(e.id,"description",t.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50",placeholder:"标签描述"})}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("input",{type:"text",placeholder:"添加标签值",className:"flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50",onKeyPress:t=>{if("Enter"===t.key){let s=t.target;em(e.id,s.value),s.value=""}}}),(0,l.jsx)("button",{onClick:()=>{let t=document.querySelector('input[placeholder="添加标签值"]');t&&(em(e.id,t.value),t.value="")},className:"px-3 py-2 bg-purple-500/20 text-purple-300 hover:bg-purple-500/30 rounded-lg text-sm transition-colors",children:"添加"})]}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:e.values.map((t,s)=>(0,l.jsxs)("span",{className:"px-2 py-1 bg-purple-500/20 text-purple-300 rounded-lg text-sm flex items-center",children:[t,(0,l.jsx)("button",{onClick:()=>eh(e.id,s),className:"ml-1 text-purple-400 hover:text-purple-300",children:(0,l.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]},"value-".concat(s,"-").concat(t)))})]})]},e.id))})]})]}),f&&"scene_selected"===m&&(0,l.jsxs)("div",{className:"p-4 border rounded-lg ".concat(1===f.scene_type?"bg-blue-500/10 border-blue-500/30":"bg-green-500/10 border-green-500/30"),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsxs)("h4",{className:"text-white font-medium",children:["已选择场景: ",f.scene_name]}),(0,l.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(1===f.scene_type?"bg-blue-500/20 text-blue-300":"bg-green-500/20 text-green-300"),children:ef(f.scene_type)}),1===f.scene_type&&(0,l.jsx)("span",{className:"px-2 py-1 rounded-full text-xs bg-gray-500/20 text-gray-300",children:"只读模式"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[1!==f.scene_type&&(0,l.jsx)("button",{onClick:()=>{if(f&&1!==f.scene_type){var e;S(!0),g({name:f.scene_name,description:f.scene_detail,dialogue_target:f.dialogue_target,dialogue_opening_prompt:f.dialogue_opening_prompt,dialogue_bg:f.dialogue_bg,dialogue_skill:f.dialogue_skill||"",dialogue_flow:f.dialogue_flow,dialogue_constraint:f.dialogue_constraint,bot_name:f.bot_name,bot_post:f.bot_post,bot_age:(null===(e=f.bot_age)||void 0===e?void 0:e.toString())||"",bot_style:f.bot_style||""})}},className:"px-3 py-1 bg-green-500/20 text-green-300 hover:bg-green-500/30 rounded-lg text-sm transition-colors",children:"编辑场景"}),(0,l.jsx)("button",{onClick:()=>{v(null),h(1===f.scene_type?"official_scenes":"custom_scenes"),S(!1)},className:"text-gray-400 hover:text-white transition-colors",children:(0,l.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"机器人信息:"}),(0,l.jsxs)("div",{className:"text-white mt-1",children:[(0,l.jsxs)("div",{children:["姓名: ",f.bot_name]}),(0,l.jsxs)("div",{children:["职位: ",f.bot_post]}),(0,l.jsxs)("div",{children:["年龄: ",f.bot_age,"岁"]}),f.bot_style&&(0,l.jsxs)("div",{children:["风格: ",f.bot_style]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"对话目标:"}),(0,l.jsx)("p",{className:"text-white mt-1",children:f.dialogue_target})]}),(0,l.jsxs)("div",{className:"md:col-span-2",children:[(0,l.jsx)("span",{className:"text-gray-400",children:"开场白:"}),(0,l.jsx)("p",{className:"text-white mt-1",children:f.dialogue_opening_prompt})]}),(0,l.jsxs)("div",{className:"md:col-span-2",children:[(0,l.jsx)("span",{className:"text-gray-400",children:"对话背景:"}),(0,l.jsx)("p",{className:"text-white mt-1",children:f.dialogue_bg})]}),(0,l.jsxs)("div",{className:"md:col-span-2",children:[(0,l.jsx)("span",{className:"text-gray-400",children:"对话流程:"}),(0,l.jsx)("p",{className:"text-white mt-1",children:f.dialogue_flow})]}),(0,l.jsxs)("div",{className:"md:col-span-2",children:[(0,l.jsx)("span",{className:"text-gray-400",children:"对话约束:"}),(0,l.jsx)("p",{className:"text-white mt-1",children:f.dialogue_constraint})]}),f.scene_tags&&f.scene_tags.length>0&&(0,l.jsxs)("div",{className:"md:col-span-2",children:[(0,l.jsx)("span",{className:"text-gray-400",children:"场景标签:"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:f.scene_tags.map((e,t)=>(0,l.jsxs)("div",{className:"bg-purple-500/20 border border-purple-500/30 rounded-lg p-2",children:[(0,l.jsx)("div",{className:"text-purple-300 font-medium text-sm mb-1",children:e.tag_name}),e.tag_detail&&(0,l.jsx)("div",{className:"text-gray-300 text-xs mb-1",children:e.tag_detail}),e.tags&&(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:e.tags.split(",").map((e,t)=>(0,l.jsx)("span",{className:"px-2 py-1 bg-purple-500/30 text-purple-200 text-xs rounded",children:e.trim()},"tag-value-".concat(t,"-").concat(e.trim())))})]},"selected-tag-".concat(t,"-").concat(e.tag_name)))})]})]})]})]})]}),"generating_script"===c&&(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"正在生成话术"}),(0,l.jsx)("p",{className:"text-gray-300",children:"AI正在为您的线索生成个性化话术"})]}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("div",{className:"relative w-32 h-32 mx-auto mb-4",children:(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,l.jsxs)("svg",{className:"w-16 h-16 text-green-400 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})}),(0,l.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-4",children:(0,l.jsx)("div",{className:"bg-gradient-to-r from-green-500 to-blue-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(es,"%")}})}),(0,l.jsx)("p",{className:"text-gray-300 text-sm",children:es>=100?"话术生成完成":"正在生成话术..."})]})]}),"script_complete"===c&&(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"话术生成成功！"}),(0,l.jsx)("p",{className:"text-gray-300",children:"个性化话术已生成，可以开始外呼任务"})]}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("div",{className:"w-24 h-24 mx-auto mb-4 bg-green-500/20 rounded-full flex items-center justify-center",children:(0,l.jsx)("svg",{className:"w-12 h-12 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),(0,l.jsxs)("div",{className:"space-y-4 text-left max-w-md mx-auto",children:[(0,l.jsxs)("div",{className:"bg-blue-500/20 border border-blue-500/30 rounded-lg p-4",children:[(0,l.jsxs)("div",{className:"flex items-center mb-2",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2 animate-pulse"}),(0,l.jsx)("span",{className:"text-blue-300 font-medium",children:"话术已生成"})]}),(0,l.jsx)("p",{className:"text-gray-300 text-sm",children:"个性化话术配置完成"})]}),(0,l.jsxs)("div",{className:"bg-purple-500/20 border border-purple-500/30 rounded-lg p-4",children:[(0,l.jsxs)("div",{className:"flex items-center mb-2",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-purple-400 rounded-full mr-2"}),(0,l.jsx)("span",{className:"text-purple-300 font-medium",children:"外呼Agent"})]}),(0,l.jsx)("p",{className:"text-gray-300 text-sm",children:"准备开始执行外呼任务"})]})]})]})]})]}),(0,l.jsxs)("div",{className:"p-6 pt-0 pb-4 border-t border-white/10 mt-auto",children:["script_config"===c&&(0,l.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,l.jsx)("button",{onClick:r,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"返回任务列表"}),(0,l.jsxs)("div",{className:"flex space-x-3",children:[(0,l.jsx)("button",{onClick:eo,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"取消"}),"scene_selected"===m||"create_custom"===m||C?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{onClick:ec,disabled:("create_custom"===m||C)&&(!p.name.trim()||!p.bot_name.trim()||!p.dialogue_target.trim()||!p.dialogue_opening_prompt.trim()||!p.dialogue_flow.trim()||0===ee.length),className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-medium rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500/50 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:"生成话术"}),("create_custom"===m||C)&&(0,l.jsx)("button",{onClick:eg,disabled:!p.name.trim()||!p.bot_name.trim()||!p.dialogue_target.trim()||!p.dialogue_opening_prompt.trim()||!p.dialogue_flow.trim()||0===ee.length,className:"px-6 py-2 bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-500 hover:to-blue-500 text-white font-medium rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500/50 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:C?"更新场景":"保存场景"})]}):(0,l.jsx)("button",{onClick:ec,disabled:!0,className:"px-6 py-2 bg-gray-500 text-gray-300 font-medium rounded-lg cursor-not-allowed",children:"请先选择场景"})]})]}),"script_complete"===c&&(0,l.jsx)("div",{className:"flex justify-center mt-4",children:(0,l.jsx)("button",{onClick:eo,className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white font-medium rounded-lg transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:"完成"})})]})]})}):null}let _={leads_product:"线索产品",leads_type:"线索等级",first_follow:"首次跟进时间区间",latest_follow:"最近跟进时间区间",next_follow:"下次跟进时间区间",first_arrive:"首次到店时间区间",is_arrive:"是否到店"};function k(e){let{isOpen:t,onClose:s,selectedTask:a,onConfigureScript:r,onStartCalling:i,onOutboundCallSuccess:c}=e,[d,x]=(0,n.useState)(!1),[u,m]=(0,n.useState)(a),h=e=>{switch(e){case 1:return{text:"已创建",color:"bg-blue-500/20 text-blue-300"};case 2:return{text:"开始外呼",color:"bg-green-500/20 text-green-300"};case 3:return{text:"外呼完成",color:"bg-purple-500/20 text-purple-300"};case 4:return{text:"已删除",color:"bg-red-500/20 text-red-300"};default:return{text:"未知状态",color:"bg-gray-500/20 text-gray-300"}}};(0,n.useEffect)(()=>{a&&m(a)},[a]);let p=async e=>{if(u)try{let t=await o.Md.updateTaskScriptId(parseInt(u.id),e.script_id);"success"===t.status?(m({...u,selectedScene:e,script_id:e.script_id,hasGeneratedScript:!0}),console.log("任务script_id更新成功:",e.script_id)):(console.error("更新任务script_id失败:",t.message),alert("更新任务场景失败，请重试"))}catch(e){console.error("更新任务script_id出错:",e),alert("更新任务场景失败，请重试")}},g=()=>{x(!0)},b=async()=>{if(u)try{let e=await o.Md.startCallTask(u.id);"success"===e.status?(alert("外呼任务已成功发起！外呼Agent开始工作。"),s(),null==c||c()):alert("外呼发起失败：".concat(e.message||"未知错误"))}catch(e){console.error("发起外呼失败:",e),alert("发起外呼失败，请重试")}},j=()=>null==u?void 0:u.selectedScene;if(!t||!u)return null;let f=((e,t)=>{if(e&&e.length>0)return e.map((e,t)=>{if("string"==typeof e)return e;let s=e.label||e.key||"",l=e.value||e.val||"",a=_[s]||s;return"".concat(a,": ").concat(l)});if(t){let e=[],s={};return Object.entries(t).forEach(t=>{let[l,a]=t;if(null===a)return;let r=_[l]||l;if(l.includes("_start")||l.includes("_end")){let e=l.replace(/_start$|_end$/,"");s[e]||(s[e]={label:_[e]||e,start:void 0,end:void 0}),l.endsWith("_start")?s[e].start=String(a):l.endsWith("_end")&&(s[e].end=String(a))}else if(l.includes("_ranges")&&Array.isArray(a)){let e=l.replace(/_ranges$/,"");s[e]||(s[e]={label:_[e]||e,ranges:[]}),s[e].ranges=a}else if("is_arrive"===l){let t="1"===a||1===a||!0===a?"是":"否";e.push("".concat(r,": ").concat(t))}else Array.isArray(a)?a.length>0&&e.push("".concat(r,": ").concat(a.join("、"))):e.push("".concat(r,": ").concat(String(a)))}),Object.values(s).forEach(t=>{if(t.ranges&&t.ranges.length>0){let s=t.ranges.map(e=>{let[t,s]=e.split("_");return"".concat(t," 至 ").concat(s)});e.push("".concat(t.label,": ").concat(s.join("、")))}else(t.start||t.end)&&(t.start&&t.end?e.push("".concat(t.label,": ").concat(t.start," 至 ").concat(t.end)):t.start?e.push("".concat(t.label,": ").concat(t.start," 起")):t.end&&e.push("".concat(t.label,": 至 ").concat(t.end)))}),e}return[]})(u.conditions,u.size_desc);return(0,l.jsxs)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-start justify-center z-50 pt-4",onClick:s,children:[(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl max-w-4xl w-full mx-4 h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 pb-0",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"任务详情"}),(0,l.jsx)("p",{className:"text-gray-300",children:"查看任务详细信息和执行状态"})]}),(0,l.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-white transition-colors",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-lg p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"任务状态"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-gray-300",children:"任务名称:"}),(0,l.jsx)("span",{className:"text-white font-medium",children:u.name})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-gray-300",children:"任务状态:"}),(0,l.jsx)("div",{className:"px-3 py-1 rounded-full text-sm ".concat(h(u.task_type).color),children:h(u.task_type).text})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-gray-300",children:"目标线索:"}),(0,l.jsx)("span",{className:"text-green-400 font-bold text-lg",children:u.targetCount})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-gray-300",children:"创建时间:"}),(0,l.jsx)("span",{className:"text-white",children:u.createdAt})]})]})]}),(0,l.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-lg p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"筛选条件"}),(0,l.jsx)("div",{className:"space-y-3",children:f.length>0?f.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-3"}),(0,l.jsx)("span",{className:"text-white",children:e})]},"condition-".concat(t,"-").concat(e))):(0,l.jsx)("div",{className:"text-gray-400 text-sm",children:"无筛选条件"})})]})]}),u.selectedScene&&(0,l.jsxs)("div",{className:"mt-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"已选择场景"}),(0,l.jsxs)("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("h4",{className:"text-white font-medium",children:u.selectedScene.scene_name}),(0,l.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(1===u.selectedScene.scene_type?"bg-blue-500/20 text-blue-300":"bg-green-500/20 text-green-300"),children:1===u.selectedScene.scene_type?"官方场景":"自定义场景"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),(0,l.jsx)("span",{className:"text-green-300 text-sm",children:"话术已生成"})]}),(0,l.jsx)("button",{onClick:g,className:"px-3 py-1 bg-blue-500/20 text-blue-300 hover:bg-blue-500/30 rounded-lg text-sm transition-colors",children:"切换场景"})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,l.jsxs)("div",{className:"bg-white/5 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-gray-400 text-xs mb-1",children:"机器人信息"}),(0,l.jsxs)("div",{className:"text-white",children:[(0,l.jsx)("div",{className:"font-medium",children:u.selectedScene.bot_name}),(0,l.jsx)("div",{className:"text-gray-300 text-xs",children:u.selectedScene.bot_post})]})]}),(0,l.jsxs)("div",{className:"bg-white/5 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-gray-400 text-xs mb-1",children:"对话目标"}),(0,l.jsx)("div",{className:"text-white text-xs line-clamp-2",children:u.selectedScene.dialogue_target})]}),(0,l.jsxs)("div",{className:"bg-white/5 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-gray-400 text-xs mb-1",children:"开场白"}),(0,l.jsx)("div",{className:"text-white text-xs line-clamp-2",children:u.selectedScene.dialogue_opening_prompt})]})]}),u.selectedScene.scene_tags&&u.selectedScene.scene_tags.length>0&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("div",{className:"text-gray-400 text-xs mb-2",children:"场景标签"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:u.selectedScene.scene_tags.map((e,t)=>(0,l.jsx)("span",{className:"px-2 py-1 bg-purple-500/20 text-purple-300 text-xs rounded",children:e.tag_name},"selected-tag-".concat(t,"-").concat(e.tag_name)))})]})]})]}),(0,l.jsxs)("div",{className:"mt-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"后续操作"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-4",children:u.selectedScene?(0,l.jsxs)("button",{onClick:b,disabled:!j(),className:"p-4 border rounded-lg transition-colors text-left ".concat(j()?"bg-green-500/20 border-green-500/30 hover:bg-green-500/30":"bg-gray-500/20 border-gray-500/30 cursor-not-allowed"),children:[(0,l.jsxs)("div",{className:"flex items-center mb-2",children:[(0,l.jsx)("svg",{className:"w-6 h-6 mr-2 ".concat(j()?"text-green-400":"text-gray-400"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),(0,l.jsx)("span",{className:"font-medium ".concat(j()?"text-green-300":"text-gray-400"),children:"开始外呼"})]}),(0,l.jsx)("p",{className:"text-sm ".concat(j()?"text-gray-400":"text-gray-500"),children:j()?"开始执行外呼任务":"请先配置话术场景"})]}):(0,l.jsxs)("button",{onClick:g,className:"p-4 bg-blue-500/20 border border-blue-500/30 rounded-lg hover:bg-blue-500/30 transition-colors text-left",children:[(0,l.jsxs)("div",{className:"flex items-center mb-2",children:[(0,l.jsx)("svg",{className:"w-6 h-6 text-blue-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,l.jsx)("span",{className:"text-blue-300 font-medium",children:"配置话术"})]}),(0,l.jsx)("p",{className:"text-gray-400 text-sm",children:"为任务配置个性化话术参数"})]})})]})]}),(0,l.jsx)("div",{className:"p-6 pt-0 pb-8 border-t border-white/10",children:(0,l.jsx)("div",{className:"flex justify-end space-x-3",children:(0,l.jsx)("button",{onClick:s,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"关闭"})})})]}),(0,l.jsx)(w,{isOpen:d,onClose:()=>{x(!1)},selectedTask:u,onBackToTaskDetail:()=>{x(!1)},onScriptConfigured:p})]})}let C={leads_product:"线索产品",leads_type:"线索等级",first_follow:"首次跟进时间区间",latest_follow:"最近跟进时间区间",next_follow:"下次跟进时间区间",first_arrive:"首次到店时间区间",is_arrive:"是否到店"};function S(e){let{isOpen:t,onClose:s,taskInfo:a,taskLeads:r=[],onRefresh:n}=e;if(!t)return null;let i=(null==a?void 0:a.size_desc)?(e=>{if(!e)return[];let t=[],s={};return Object.entries(e).forEach(e=>{let[l,a]=e,r=C[l]||l;if(l.includes("_start")||l.includes("_end")){let e=l.replace(/_start$|_end$/,"");s[e]||(s[e]={label:C[e]||e,start:void 0,end:void 0}),l.endsWith("_start")?s[e].start=String(a):l.endsWith("_end")&&(s[e].end=String(a))}else if("is_arrive"===l){let e="1"===a||1===a||!0===a?"是":"否";t.push("".concat(r,": ").concat(e))}else t.push("".concat(r,": ").concat(String(a)))}),Object.values(s).forEach(e=>{(e.start||e.end)&&(e.start&&e.end?t.push("".concat(e.label,": ").concat(e.start," 至 ").concat(e.end)):e.start?t.push("".concat(e.label,": ").concat(e.start," 起")):e.end&&t.push("".concat(e.label,": 至 ").concat(e.end)))}),t})(a.size_desc):[];return(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-start justify-center z-50 pt-4",onClick:s,children:(0,l.jsx)("div",{className:"bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl max-w-6xl w-full mx-4 h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 pb-0",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"任务线索详情"}),a&&(0,l.jsxs)("div",{className:"text-gray-300 space-y-1",children:[(0,l.jsxs)("p",{children:["任务名称: ",a.task_name]}),(0,l.jsxs)("p",{children:["线索数量: ",a.leads_count]}),i.length>0&&(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("p",{className:"text-sm font-medium mb-1",children:"筛选条件:"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:i.map((e,t)=>(0,l.jsx)("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-300 text-xs rounded",children:e},"condition-".concat(t,"-").concat(e)))})]})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[n&&(0,l.jsx)("button",{onClick:n,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded transition-colors",children:"刷新数据"}),(0,l.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-white transition-colors",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})]}),0===r.length?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"text-gray-400 mb-4",children:(0,l.jsx)("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),(0,l.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"暂无线索"}),(0,l.jsx)("p",{className:"text-gray-400",children:"该任务下没有找到线索信息"})]}):(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white",children:"筛选后的线索列表"}),(0,l.jsxs)("span",{className:"text-gray-300 text-sm",children:["共 ",r.length," 条线索"]})]}),(0,l.jsx)("div",{className:"bg-white/5 border border-white/10 rounded-lg overflow-hidden",children:(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full",children:[(0,l.jsx)("thead",{className:"bg-white/10",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"序号"}),(0,l.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"姓名"}),(0,l.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"手机号"}),(0,l.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"线索ID"}),(0,l.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"状态"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-white/10",children:r.map((e,t)=>(0,l.jsxs)("tr",{className:"hover:bg-white/5 transition-colors",children:[(0,l.jsx)("td",{className:"px-4 py-3 text-sm text-gray-300",children:t+1}),(0,l.jsx)("td",{className:"px-4 py-3 text-sm text-white font-medium",children:e.leads_name||"未知"}),(0,l.jsx)("td",{className:"px-4 py-3 text-sm text-gray-300",children:e.leads_phone||"未知"}),(0,l.jsx)("td",{className:"px-4 py-3 text-sm text-gray-400",children:e.leads_id}),(0,l.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,l.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(0===e.call_type?"bg-gray-500/20 text-gray-300":1===e.call_type?"bg-green-500/20 text-green-300":2===e.call_type?"bg-red-500/20 text-red-300":"bg-blue-500/20 text-blue-300"),children:0===e.call_type?"未开始":1===e.call_type?"已接通":2===e.call_type?"未接通":"未知"})})]},e.id||"lead-".concat(t)))})]})})})]})]})})})}let M=new Map;function L(e){let{isOpen:t,onClose:s,taskId:a,taskName:r,onRefresh:i,taskType:c,onTaskTypeChange:d}=e,[x,u]=(0,n.useState)([]),[m,h]=(0,n.useState)(!1),[p,g]=(0,n.useState)(null),[b,j]=(0,n.useState)(new Set),[f,v]=(0,n.useState)(null),N=(0,n.useRef)(null),y=(0,n.useRef)(0),w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e4,s=M.get(e);return!!s&&Date.now()-s.timestamp<t},_=e=>{let t=M.get(e);return t?t.data:null},k=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4;M.set(e,{data:t,timestamp:Date.now(),cacheDuration:s})},C=(0,n.useCallback)(()=>{N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{S()},500)},[]),S=async()=>{if(!t||!a)return;let e=Date.now();if(!(e-y.current<3e3)){h(!0),g(null),y.current=e;try{let e;let t="task_execution_".concat(a);if(w(t,1e4)?e=_(t):(e=await o.Md.queryTaskExecution(parseInt(a)),"success"===e.status&&k(t,e,1e4)),"success"!==e.status)throw Error("获取任务执行情况失败");let s=e.data,l=s.jobs_data||[],r=l.filter(e=>"Succeeded"===e.Status).length;l.filter(e=>"Scheduling"===e.Status).length;let n=l.length;if(v({is_completed:n>0&&r===n,total_calls:n,connected_calls:r,not_connected_calls:n-r,query_time:s.query_time}),!s.jobs_data||0===s.jobs_data.length){g("该任务暂无外呼记录"),h(!1);return}let i=s.jobs_data.map(e=>({job_id:e.JobId||"未知",job_group_id:e.JobGroupId||"未知",status:e.Status||"未知",priority:e.Priority||0,created_time:new Date().toISOString(),modified_time:new Date().toISOString(),raw_data:e}));u(i)}catch(e){g(e instanceof Error?e.message:"获取外呼状态失败")}finally{h(!1)}}};(0,n.useEffect)(()=>(t&&C(),()=>{N.current&&clearTimeout(N.current)}),[t,a,C]),(0,n.useEffect)(()=>()=>{M.delete("task_execution_".concat(a))},[a]);let L=e=>{if(!e)return"bg-gray-500/20 text-gray-300";switch(e.toLowerCase()){case"executing":return"bg-blue-500/20 text-blue-300";case"succeeded":case"succeededfinish":case"succeededchathangupafternoanswer":case"succeededchathangupaftersilence":case"succeededclienthangupafternoanswer":case"succeededclienthangup":case"succeededtransferbyintent":case"succeededtransferafternoanswer":case"succeededinointeraction":case"succeedederror":case"succeededspecialinterceptvoiceassistant":case"succeededspecialinterceptextensionnumbertransfer":return"bg-green-500/20 text-green-300";case"failed":return"bg-red-500/20 text-red-300";case"noanswer":case"notexist":case"busy":case"notconnected":case"poweredoff":case"outofservice":case"inarrears":case"emptynumber":case"perdaycallcountlimit":case"contactblocklist":case"callernotregistered":case"terminated":case"verificationcancelled":case"outofservicenocall":case"inarrearsnocall":case"callingnumbernotexist":return"bg-yellow-500/20 text-yellow-300";default:return"bg-gray-500/20 text-gray-300"}},T=e=>e?({Executing:"正在拨打",Succeeded:"已接通",NoAnswer:"未接通-无人接听",NotExist:"未接通-空号",Busy:"未接通-占线",Cancelled:"未呼出-任务停止",Failed:"失败",NotConnected:"未接通-无法接通",PoweredOff:"未接通-关机",OutOfService:"未接通-被叫停机",InArrears:"未接通-被叫欠费",EmptyNumber:"未呼出-空号不外呼",PerDayCallCountLimit:"未呼出-超出每日上限",ContactBlockList:"未呼出-黑名单",CallerNotRegistered:"未呼出-主叫号码未注册",Terminated:"未呼出-被终止",VerificationCancelled:"未呼出-呼叫前验证不通过取消",OutOfServiceNoCall:"未呼出-被叫停机不外呼",InArrearsNoCall:"未呼出-被叫欠费不外呼",CallingNumberNotExist:"未呼出-主叫号码不存在",SucceededFinish:"已接通-正常完结",SucceededChatbotHangUpAfterNoAnswer:"已接通-拒识后机器人挂机",SucceededChatbotHangUpAfterSilence:"已接通-静默超时挂机",SucceededClientHangUpAfterNoAnswer:"已接通-拒识后用户挂机",SucceededClientHangUp:"已接通-用户无理由挂机",SucceededTransferByIntent:"已接通-命中意图转人工",SucceededTransferAfterNoAnswer:"已接通-拒识转人工",SucceededInoInterAction:"已接通-用户侧无交互",SucceededError:"已接通-系统异常中断",SucceededSpecialInterceptVoiceAssistant:"已接通-特殊情况拦截-语音助手",SucceededSpecialInterceptExtensionNumberTransfer:"已接通-特殊情况拦截-分机号转接"})[e]||e:"未知状态",D=e=>e?new Date(e).toLocaleString("zh-CN"):"未知时间",I=e=>{if(!e)return"0秒";let t=Math.floor(e/1e3),s=Math.floor(t/60),l=t%60;return s>0?"".concat(s,"分").concat(l,"秒"):"".concat(l,"秒")},z=e=>{let t=new Set(b);t.has(e)?t.delete(e):t.add(e),j(t)},A=()=>{s()},B=async e=>{try{let t=await o.Md.suspendResumeTask(parseInt(a),e);if("success"===t.status)console.log("".concat("suspend"===e?"暂停":"重启","任务成功:"),t.data),d&&d(t.data.task_type),S();else{console.error("".concat("suspend"===e?"暂停":"重启","任务失败:"),t.message);try{let e=await o.Md.queryTaskExecution(parseInt(a));if("success"===e.status){let t=e.data;if(console.log("操作失败后查询任务状态:",t),2!==t.task_type&&5!==t.task_type){console.log("任务状态已变化，关闭弹窗"),s();return}}}catch(e){console.error("查询任务状态失败:",e)}}}catch(t){console.error("".concat("suspend"===e?"暂停":"重启","任务失败:"),t);try{let e=await o.Md.queryTaskExecution(parseInt(a));if("success"===e.status){let t=e.data;if(console.log("操作失败后查询任务状态:",t),2!==t.task_type&&5!==t.task_type){console.log("任务状态已变化，关闭弹窗"),s();return}}}catch(e){console.error("查询任务状态失败:",e)}}};return t?(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-start justify-center z-[80] pt-4",onClick:A,children:(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl max-w-6xl w-full mx-4 max-h-[90vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"电话拨打情况"}),(0,l.jsxs)("p",{className:"text-gray-300",children:["任务：",r]})]}),(0,l.jsx)("button",{onClick:A,className:"text-gray-400 hover:text-white transition-colors",style:{position:"relative",zIndex:1e3},children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),f&&(0,l.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4 mb-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white mb-3",children:"任务状态概览"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,l.jsxs)("div",{className:"bg-white/5 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-sm text-gray-400 mb-1",children:"任务状态"}),(0,l.jsx)("div",{className:"text-lg font-medium ".concat(f.is_completed?"text-green-400":"text-blue-400"),children:f.is_completed?"已完成":"执行中"})]}),(0,l.jsxs)("div",{className:"bg-white/5 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-sm text-gray-400 mb-1",children:"总任务数"}),(0,l.jsx)("div",{className:"text-lg font-medium text-white",children:f.total_calls||0})]}),(0,l.jsxs)("div",{className:"bg-white/5 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-sm text-gray-400 mb-1",children:"已接通任务数"}),(0,l.jsx)("div",{className:"text-lg font-medium text-green-400",children:f.connected_calls||0})]}),(0,l.jsxs)("div",{className:"bg-white/5 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-sm text-gray-400 mb-1",children:"未接通任务数"}),(0,l.jsx)("div",{className:"text-lg font-medium text-yellow-400",children:f.not_connected_calls||0})]})]}),f.query_time&&(0,l.jsxs)("div",{className:"mt-3 text-xs text-gray-400",children:["查询时间: ",f.query_time]})]}),m?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-300",children:"正在加载外呼状态..."})]}):p?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"text-red-400 mb-4",children:(0,l.jsx)("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,l.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"加载失败"}),(0,l.jsx)("p",{className:"text-gray-400",children:p})]}):0===x.length?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"text-gray-400 mb-4",children:(0,l.jsx)("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),(0,l.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"暂无外呼记录"}),(0,l.jsx)("p",{className:"text-gray-400",children:"该任务还没有外呼记录"})]}):(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white",children:"外呼任务详情"}),(0,l.jsxs)("span",{className:"text-gray-300 text-sm",children:["共 ",x.length," 个外呼任务"]})]}),(0,l.jsx)("div",{className:"space-y-3",children:x.map((e,t)=>{var s,a,r,n,i,c,o,d;let x=b.has(e.job_id),u=null===(a=e.raw_data)||void 0===a?void 0:null===(s=a.Contacts)||void 0===s?void 0:s[0],m=null===(n=e.raw_data)||void 0===n?void 0:null===(r=n.Tasks)||void 0===r?void 0:r[0];return(0,l.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2 animate-pulse"}),(0,l.jsxs)("h4",{className:"text-white font-medium",children:["外呼任务 ",t+1]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(L(e.status)),children:T(e.status)}),(0,l.jsx)("button",{onClick:()=>z(e.job_id),className:"text-blue-400 hover:text-blue-300 text-sm transition-colors",children:x?"收起详情":"查看详情"})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"联系人:"}),(0,l.jsx)("span",{className:"text-white ml-2",children:(null==u?void 0:u.ContactName)||"未知"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"电话:"}),(0,l.jsx)("span",{className:"text-white ml-2",children:(null==u?void 0:u.PhoneNumber)||"未知"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"通话时长:"}),(0,l.jsx)("span",{className:"text-white ml-2",children:m?I(m.Duration):"0秒"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"拨打时间:"}),(0,l.jsx)("span",{className:"text-white ml-2",children:m?D(m.ActualTime):"未知"})]})]}),x&&(0,l.jsxs)("div",{className:"mt-4 pt-4 border-t border-white/10 space-y-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"任务ID:"}),(0,l.jsx)("span",{className:"text-white ml-2 font-mono text-xs",children:e.job_id})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"优先级:"}),(0,l.jsx)("span",{className:"text-white ml-2",children:e.priority})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"创建时间:"}),(0,l.jsx)("span",{className:"text-white ml-2",children:e.created_time||"未知"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"修改时间:"}),(0,l.jsx)("span",{className:"text-white ml-2",children:e.modified_time||"未知"})]})]}),(null===(i=e.raw_data)||void 0===i?void 0:i.Contacts)&&e.raw_data.Contacts.length>0&&(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsx)("span",{className:"text-gray-400 text-sm",children:"联系人信息:"}),(0,l.jsx)("div",{className:"text-white text-sm mt-1 bg-white/5 rounded p-2",children:e.raw_data.Contacts.map((e,t)=>(0,l.jsxs)("div",{className:"mb-2 last:mb-0",children:[(0,l.jsxs)("div",{children:["姓名: ",e.ContactName]}),(0,l.jsxs)("div",{children:["电话: ",e.PhoneNumber]}),(0,l.jsxs)("div",{children:["引用ID: ",e.ReferenceId]}),(0,l.jsxs)("div",{children:["联系人ID: ",e.ContactId]})]},t))})]}),(null===(c=e.raw_data)||void 0===c?void 0:c.Tasks)&&e.raw_data.Tasks.length>0&&(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsx)("span",{className:"text-gray-400 text-sm",children:"通话详情:"}),(0,l.jsx)("div",{className:"space-y-2 mt-1",children:e.raw_data.Tasks.map((e,t)=>(0,l.jsxs)("div",{className:"bg-white/5 rounded p-2",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-xs",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"任务ID:"}),(0,l.jsx)("span",{className:"text-white ml-1",children:e.TaskId})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"状态:"}),(0,l.jsx)("span",{className:"ml-1 px-1 py-0.5 rounded text-xs ".concat(L(e.Status)),children:T(e.Status)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"主叫号码:"}),(0,l.jsx)("span",{className:"text-white ml-1",children:e.CallingNumber})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"被叫号码:"}),(0,l.jsx)("span",{className:"text-white ml-1",children:e.CalledNumber})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"通话时长:"}),(0,l.jsx)("span",{className:"text-white ml-1",children:I(e.Duration)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"实际时间:"}),(0,l.jsx)("span",{className:"text-white ml-1",children:D(e.ActualTime)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"计划时间:"}),(0,l.jsx)("span",{className:"text-white ml-1",children:D(e.PlanedTime)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"通话ID:"}),(0,l.jsx)("span",{className:"text-white ml-1",children:e.CallId})]})]}),e.Conversation&&e.Conversation.length>0&&(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("span",{className:"text-gray-400 text-xs",children:"对话记录:"}),(0,l.jsx)("div",{className:"mt-1 space-y-1",children:e.Conversation.map((e,t)=>(0,l.jsxs)("div",{className:"text-xs bg-white/5 rounded p-1",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-xs px-1 py-0.5 rounded ".concat("Robot"===e.Speaker?"bg-blue-500/20 text-blue-300":"bg-green-500/20 text-green-300"),children:"Robot"===e.Speaker?"机器人":"客户"}),(0,l.jsx)("span",{className:"text-gray-400 text-xs",children:D(e.Timestamp)})]}),e.Script&&(0,l.jsx)("div",{className:"text-white mt-1",children:e.Script}),e.Summary&&e.Summary.length>0&&(0,l.jsxs)("div",{className:"mt-1 text-yellow-300 text-xs",children:["总结: ",e.Summary.join(", ")]})]},t))})]})]},t))})]}),(null===(o=e.raw_data)||void 0===o?void 0:o.Summary)&&e.raw_data.Summary.length>0&&(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsx)("span",{className:"text-gray-400 text-sm",children:"总结信息:"}),(0,l.jsx)("div",{className:"text-white text-sm mt-1 bg-white/5 rounded p-2",children:e.raw_data.Summary.map((e,t)=>(0,l.jsxs)("div",{className:"mb-1 last:mb-0",children:[(0,l.jsxs)("span",{className:"text-gray-400",children:[e.SummaryName,":"]}),(0,l.jsx)("span",{className:"text-white ml-1",children:e.Content})]},t))})]}),(null===(d=e.raw_data)||void 0===d?void 0:d.Extras)&&e.raw_data.Extras.length>0&&(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsx)("span",{className:"text-gray-400 text-sm",children:"额外信息:"}),(0,l.jsx)("div",{className:"text-white text-sm mt-1 bg-white/5 rounded p-2",children:e.raw_data.Extras.map((e,t)=>(0,l.jsxs)("div",{className:"mb-1 last:mb-0",children:[(0,l.jsxs)("span",{className:"text-gray-400",children:[e.Key,":"]}),(0,l.jsx)("span",{className:"text-white ml-1",children:e.Value})]},t))})]}),e.result&&(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsx)("span",{className:"text-gray-400 text-sm",children:"执行结果:"}),(0,l.jsx)("div",{className:"text-white text-sm mt-1 bg-white/5 rounded p-2",children:e.result})]}),e.failure_reason&&(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsx)("span",{className:"text-red-400 text-sm",children:"失败原因:"}),(0,l.jsx)("div",{className:"text-red-300 text-sm mt-1 bg-red-500/10 rounded p-2",children:e.failure_reason})]}),e.db_record&&(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsx)("span",{className:"text-gray-400 text-sm",children:"数据库记录:"}),(0,l.jsx)("div",{className:"text-gray-300 text-sm mt-1 bg-white/5 rounded p-2",children:(0,l.jsx)("pre",{className:"text-xs overflow-x-auto",children:JSON.stringify(e.db_record,null,2)})})]})]})]},e.job_id)})})]})]}),(0,l.jsx)("div",{className:"p-6 border-t border-white/10 flex-shrink-0",children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"flex space-x-2",children:[2===c&&(0,l.jsx)("button",{onClick:B.bind(null,"suspend"),className:"px-4 py-2 bg-yellow-500/20 text-yellow-300 hover:bg-yellow-500/30 rounded-lg transition-colors",style:{position:"relative",zIndex:1e3},children:"暂停任务"}),5===c&&(0,l.jsx)("button",{onClick:B.bind(null,"resume"),className:"px-4 py-2 bg-green-500/20 text-green-300 hover:bg-green-500/30 rounded-lg transition-colors",style:{position:"relative",zIndex:1e3},children:"重启任务"})]}),(0,l.jsxs)("div",{className:"flex space-x-3",children:[(0,l.jsx)("button",{onClick:()=>{S(),null==i||i()},className:"px-4 py-2 bg-blue-500/20 text-blue-300 hover:bg-blue-500/30 rounded-lg transition-colors",style:{position:"relative",zIndex:1e3},children:"刷新状态"}),(0,l.jsx)("button",{onClick:A,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",style:{position:"relative",zIndex:1e3},children:"关闭"})]})]})})]})}):null}function T(e){let{isOpen:t,onClose:s,callingTasks:a,onTasksUpdate:r,onRefreshTaskDetails:i}=e,[c,d]=(0,n.useState)(!1),[x,u]=(0,n.useState)(null),[m,h]=(0,n.useState)(a),[p,g]=(0,n.useState)(!1),b=(0,n.useRef)(null),j=(0,n.useRef)({});(0,n.useEffect)(()=>{h(a)},[a]),(0,n.useEffect)(()=>{if(!t){b.current&&(clearInterval(b.current),b.current=null);return}let e=async()=>{if(!p){g(!0);try{let e=Date.now(),t=await Promise.all(m.map(async t=>{let s=j.current[t.id]||0;if(e-s<6e4)return t;try{let s=await o.Md.queryTaskExecution(parseInt(t.id));if("success"===s.status){let l=s.data;j.current[t.id]=e;let a=l.jobs_data||[],r=a.filter(e=>"Succeeded"===e.Status).length,n=a.filter(e=>"Scheduling"===e.Status).length,i=a.length,c=i>0&&r===i;l.error_count,console.log("任务 ".concat(t.id," 状态计算:"),{totalJobs:i,succeededJobs:r,schedulingJobs:n,isCompleted:c,originalTaskType:l.task_type});let o=l.task_type||(c?3:2);return{...t,status:c?"completed":1===o?"pending":"calling",task_type:o,total_jobs:i,updated_count:r,error_count:l.error_count,targetCount:t.targetCount,name:t.name,createdAt:t.createdAt}}}catch(e){return console.error("查询任务 ".concat(t.id," 执行情况失败:"),e),t}}));if(t.some((e,t)=>{let s=m[t];if(!e||!s)return!1;let l=e.task_type!==s.task_type||e.status!==s.status;return l&&console.log("DEBUG - Task changed:",s.id,"from",s.task_type,"to",e.task_type),l})){let e=t.filter(e=>void 0!==e);console.log("DEBUG - Task status updated:",e.length,"tasks"),h(e),r&&r(e)}}catch(e){console.error("批量检查任务状态失败:",e)}finally{g(!1)}}};return e(),b.current=setInterval(e,6e4),()=>{b.current&&(clearInterval(b.current),b.current=null)}},[t,m,p,r]);let f=(0,n.useCallback)(async e=>{try{let t=await o.Md.queryTaskExecution(parseInt(e.id));if("success"===t.status){let s=t.data;console.log("任务执行情况:",s);let l=s.jobs_data||[],a=l.filter(e=>"Succeeded"===e.Status).length,n=l.filter(e=>"Scheduling"===e.Status).length,i=l.length,c=i>0&&a===i;console.log("点击任务 ".concat(e.id," 状态计算:"),{totalJobs:i,succeededJobs:a,schedulingJobs:n,isCompleted:c,originalTaskType:s.task_type});let o=s.task_type||(c?3:2),d={...e,status:c?"completed":"calling",task_type:o,total_jobs:i,updated_count:a,error_count:s.error_count};if(h(t=>t.map(t=>t.id===e.id?d:t)),r){let t=m.map(t=>t.id===e.id?d:t);r(t)}u(d)}else u(e);d(!0)}catch(t){console.error("查询任务执行情况失败:",t),u(e),d(!0)}},[m,r]),v=(0,n.useCallback)(()=>{s()},[s]),N=(0,n.useCallback)(async()=>{if(x)try{let e=await o.Md.getCallTaskDetails(x.id);"success"===e.status&&(console.log("任务详情已刷新:",e.data),null==i||i(x.id))}catch(e){console.error("刷新任务详情失败:",e)}},[x,i]),y=(0,n.useCallback)(async(e,t)=>{try{let l=await o.Md.suspendResumeTask(parseInt(e.id),t);if("success"===l.status){console.log("".concat("suspend"===t?"暂停":"重启","任务成功:"),l.data);let s={...e,task_type:l.data.task_type};if(h(t=>t.map(t=>t.id===e.id?s:t)),r){let t=m.map(t=>t.id===e.id?s:t);r(t)}}else{console.error("".concat("suspend"===t?"暂停":"重启","任务失败:"),l.message);try{let t=await o.Md.queryTaskExecution(parseInt(e.id));if("success"===t.status){let e=t.data;if(console.log("操作失败后查询任务状态:",e),2!==e.task_type&&5!==e.task_type){console.log("任务状态已变化，关闭弹窗"),s();return}}}catch(e){console.error("查询任务状态失败:",e)}}}catch(l){console.error("".concat("suspend"===t?"暂停":"重启","任务失败:"),l);try{let t=await o.Md.queryTaskExecution(parseInt(e.id));if("success"===t.status){let e=t.data;if(console.log("操作失败后查询任务状态:",e),2!==e.task_type&&5!==e.task_type){console.log("任务状态已变化，关闭弹窗"),s();return}}}catch(e){console.error("查询任务状态失败:",e)}}},[m,r,s]),w=(0,n.useMemo)(()=>{let e=m.filter(e=>2===e.task_type||3===e.task_type||5===e.task_type);return console.log("DEBUG - displayTasks:",e.length,"from total tasks:",m.length),e},[m]),_=(0,n.useMemo)(()=>{let e=m.filter(e=>2===e.task_type).length;return console.log("DEBUG - executingTasks:",e,"tasks:",m),e},[m]),k=(0,n.useMemo)(()=>{let e=m.filter(e=>3===e.task_type).length;return console.log("DEBUG - completedTasks:",e),e},[m]),C=(0,n.useMemo)(()=>{let e=m.reduce((e,t)=>e+(t.targetCount||0),0);return console.log("DEBUG - totalLeads:",e,"tasks with targetCount:",m.map(e=>({id:e.id,targetCount:e.targetCount}))),e},[m]),S=(0,n.useMemo)(()=>{let e=_+k;return 0===e?0:Math.round(k/e*100)},[_,k]);return t?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-start justify-center z-[70] pt-4",onClick:v,children:(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl max-w-4xl w-full mx-4 h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-white/10 flex-shrink-0",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-white mb-2",children:"外呼Agent监控"}),(0,l.jsx)("p",{className:"text-gray-300",children:"实时监控外呼Agent的工作状态和任务执行情况"})]}),(0,l.jsx)("button",{onClick:v,className:"text-gray-400 hover:text-white transition-colors",children:(0,l.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto min-h-0",children:(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsxs)("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-6 mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"w-3 h-3 bg-blue-400 rounded-full mr-3"}),(0,l.jsx)("h3",{className:"text-lg font-semibold text-white",children:"外呼Agent状态"})]}),(0,l.jsx)("span",{className:"text-blue-300 text-sm font-medium",children:_>0?"工作中":"空闲中"})]}),_>0&&(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,l.jsx)("span",{className:"text-gray-300",children:"总体进度"}),(0,l.jsxs)("span",{className:"text-blue-300 font-medium",children:[S,"%"]})]}),(0,l.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2 overflow-hidden",children:(0,l.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(S,"%")}})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,l.jsxs)("div",{className:"bg-white/5 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-blue-400 font-bold text-lg",children:_}),(0,l.jsx)("div",{className:"text-gray-400 text-xs",children:"执行中任务"})]}),(0,l.jsxs)("div",{className:"bg-white/5 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-green-400 font-bold text-lg",children:k}),(0,l.jsx)("div",{className:"text-gray-400 text-xs",children:"已完成任务"})]}),(0,l.jsxs)("div",{className:"bg-white/5 rounded-lg p-3",children:[(0,l.jsx)("div",{className:"text-purple-400 font-bold text-lg",children:C}),(0,l.jsx)("div",{className:"text-gray-400 text-xs",children:"总线索数"})]})]})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"任务列表"}),0===w.length?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"text-gray-400 mb-4",children:(0,l.jsx)("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),(0,l.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"暂无外呼任务"}),(0,l.jsx)("p",{className:"text-gray-400",children:0===m.length?"当前没有任务":"当前没有执行中或已完成的外呼任务"}),(0,l.jsxs)("p",{className:"text-gray-500 text-xs mt-2",children:["调试信息: 总任务数 ",m.length,", 显示任务数 ",w.length]})]}):(0,l.jsx)("div",{className:"space-y-3",children:w.map(e=>(0,l.jsxs)("div",{className:"bg-white/5 border border-white/10 rounded-lg p-4 cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>f(e),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2"}),(0,l.jsx)("h4",{className:"text-white font-medium",children:e.name})]}),(0,l.jsx)("div",{className:"flex items-center space-x-2",children:3===e.task_type?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-green-300 text-sm font-medium",children:"已完成"}),(0,l.jsx)("svg",{className:"w-4 h-4 text-green-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})]}):2===e.task_type?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-blue-300 text-sm font-medium",children:"执行中"}),(0,l.jsx)("svg",{className:"w-4 h-4 text-blue-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})]}):5===e.task_type?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-yellow-300 text-sm font-medium",children:"已暂停"}),(0,l.jsx)("svg",{className:"w-4 h-4 text-yellow-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"})})]}):1===e.task_type?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-gray-300 text-sm font-medium",children:"已创建"}),(0,l.jsx)("svg",{className:"w-4 h-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-red-300 text-sm font-medium",children:"未知状态"}),(0,l.jsx)("svg",{className:"w-4 h-4 text-red-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"目标线索:"}),(0,l.jsx)("span",{className:"text-white ml-2 font-medium",children:e.targetCount})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"创建时间:"}),(0,l.jsx)("span",{className:"text-white ml-2",children:e.createdAt})]})]}),void 0!==e.total_jobs&&(0,l.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-sm mt-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"总任务:"}),(0,l.jsx)("span",{className:"text-white ml-2",children:e.total_jobs})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"已完成:"}),(0,l.jsx)("span",{className:"text-green-300 ml-2",children:e.updated_count||0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"进行中:"}),(0,l.jsx)("span",{className:"text-blue-300 ml-2",children:e.total_jobs-(e.updated_count||0)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"错误数:"}),(0,l.jsx)("span",{className:"ml-2 ".concat(e.error_count&&e.error_count>0?"text-red-300":"text-gray-300"),children:e.error_count||0})]})]}),(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsxs)("div",{className:"flex justify-between text-xs mb-1",children:[(0,l.jsx)("span",{className:"text-gray-400",children:"任务进度"}),(0,l.jsx)("span",{className:"text-blue-300",children:3===e.task_type?"100%":2===e.task_type&&e.total_jobs&&void 0!==e.updated_count?"".concat(Math.round(e.updated_count/e.total_jobs*100),"%"):2===e.task_type?"进行中":"0%"})]}),(0,l.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-1.5 overflow-hidden",children:(0,l.jsx)("div",{className:"h-1.5 rounded-full transition-all duration-300 ".concat(3===e.task_type?"bg-green-500":2===e.task_type?"bg-blue-500":"bg-gray-500"),style:{width:3===e.task_type?"100%":2===e.task_type&&e.total_jobs&&void 0!==e.updated_count?"".concat(Math.round(e.updated_count/e.total_jobs*100),"%"):2===e.task_type?"50%":"0%"}})})]}),(0,l.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,l.jsx)("div",{className:"text-xs text-blue-400",children:"点击查看电话拨打情况"}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[2===e.task_type&&(0,l.jsx)("button",{onClick:t=>{t.stopPropagation(),y(e,"suspend")},className:"px-3 py-1 bg-yellow-500/20 text-yellow-300 hover:bg-yellow-500/30 rounded text-xs transition-colors",children:"暂停"}),5===e.task_type&&(0,l.jsx)("button",{onClick:t=>{t.stopPropagation(),y(e,"resume")},className:"px-3 py-1 bg-green-500/20 text-green-300 hover:bg-green-500/30 rounded text-xs transition-colors",children:"重启"})]})]})]},e.id))})]})]})}),(0,l.jsx)("div",{className:"p-6 border-t border-white/10 flex-shrink-0",children:(0,l.jsx)("div",{className:"flex justify-end space-x-3",children:(0,l.jsx)("button",{onClick:v,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"关闭"})})})]})}),x&&(0,l.jsx)(L,{isOpen:c,onClose:()=>{d(!1),u(null)},taskId:x.id,taskName:x.name,onRefresh:N,taskType:x.task_type,onTaskTypeChange:e=>{let t={...x,task_type:e};u(t),h(e=>e.map(e=>e.id===x.id?t:e)),r&&r(m.map(e=>e.id===x.id?t:e))}})]}):null}function D(e){let{isOpen:t,onClose:s,selectedRecords:a}=e,[r,i]=(0,n.useState)("同步任务-"),[c,o]=(0,n.useState)("random"),[d,x]=(0,n.useState)(""),[u,m]=(0,n.useState)(new Date),[h,p]=(0,n.useState)(new Date(Date.now()+6048e5)),[b,j]=(0,n.useState)(""),[f,v]=(0,n.useState)(!1),[N,y]=(0,n.useState)(0),[w,_]=(0,n.useState)(""),[k,C]=(0,n.useState)(!1),S=e=>{if(!e)return"-";try{return new Date(e).toLocaleString("zh-CN")}catch(t){return e}},M=()=>u&&h?u>=h?(j("结束时间必须晚于开始时间"),!1):(j(""),!0):(j("请设置开始时间和结束时间"),!1),L=async()=>{if(!r.trim()){alert("请输入任务名称");return}if("specific_person"===c&&!d){alert("请选择指定跟进人");return}if(M()){C(!0),v(!0),y(0),_("正在创建任务...");try{let e=["正在创建任务...","正在分配跟进人员...","正在同步线索数据...","正在上传到DCC系统...","正在验证数据完整性...","同步完成！"];for(let t=0;t<e.length;t++)_(e[t]),await new Promise(e=>setTimeout(e,800)),y((t+1)/e.length*100);v(!1)}catch(e){_("同步失败，请重试"),v(!1)}}},T=()=>{f||(i("同步任务-"),o("random"),x(""),m(new Date),p(new Date(Date.now()+6048e5)),j(""),y(0),_(""),C(!1),v(!1),s())};return t?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[70]",onClick:T}),(0,l.jsx)("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-white/10 flex-shrink-0",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-xl font-semibold text-white",children:"同步到DCC"}),(0,l.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"将选中的线索同步到DCC系统"})]}),(0,l.jsx)("button",{onClick:T,disabled:f,className:"p-2 hover:bg-white/10 rounded-lg transition-colors disabled:opacity-50",children:(0,l.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:k?(0,l.jsxs)("div",{className:"text-center py-8",children:[f?(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("div",{className:"w-16 h-16 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,l.jsx)("svg",{className:"w-8 h-8 text-blue-400 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,l.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"正在同步到DCC"}),(0,l.jsx)("p",{className:"text-gray-300",children:"请稍候，正在处理您的请求..."})]}),(0,l.jsxs)("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsx)("span",{className:"text-blue-400 font-medium",children:w}),(0,l.jsxs)("span",{className:"text-blue-400 text-sm",children:[Math.round(N),"%"]})]}),(0,l.jsx)("div",{className:"w-full bg-blue-500/20 rounded-full h-2",children:(0,l.jsx)("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(N,"%")}})})]})]}):(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("div",{className:"w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,l.jsx)("svg",{className:"w-8 h-8 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,l.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"同步成功"}),(0,l.jsx)("p",{className:"text-gray-300",children:"请前去DCC系统查看数据"})]}),!f&&(0,l.jsx)("button",{onClick:T,className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-lg transition-colors",children:"确定"})]}):(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[(0,l.jsx)("h4",{className:"text-white font-medium mb-4",children:"同步设置"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"md:col-span-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"任务名称"}),(0,l.jsx)("input",{type:"text",value:r,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"请输入任务名称"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"分配方式"}),(0,l.jsxs)("select",{value:c,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[(0,l.jsx)("option",{value:"random",children:"随机分配"}),(0,l.jsx)("option",{value:"followup_person",children:"分配给线索跟进人"}),(0,l.jsx)("option",{value:"specific_person",children:"指定跟进人"})]})]}),"specific_person"===c&&(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"指定跟进人"}),(0,l.jsxs)("select",{value:d,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[(0,l.jsx)("option",{value:"",children:"请选择跟进人"}),[{id:"1",name:"张经理",department:"DCC经理"},{id:"2",name:"李专员",department:"电销专员"},{id:"3",name:"王专员",department:"电销专员"},{id:"4",name:"赵专员",department:"电销专员"},{id:"5",name:"钱专员",department:"电销专员"}].map(e=>(0,l.jsxs)("option",{value:e.id,children:[e.name," - ",e.department]},e.id))]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"任务开始时间"}),(0,l.jsx)(g.ZP,{selected:u,onChange:e=>{m(e),e&&h&&e>=h?j("结束时间必须晚于开始时间"):j("")},className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholderText:"选择开始时间",dateFormat:"yyyy-MM-dd HH:mm",showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"任务结束时间"}),(0,l.jsx)(g.ZP,{selected:h,onChange:e=>{p(e),e&&u&&u>=e?j("结束时间必须晚于开始时间"):j("")},minDate:u||void 0,className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholderText:"选择结束时间",dateFormat:"yyyy-MM-dd HH:mm",showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15})]}),b&&(0,l.jsx)("div",{className:"md:col-span-2",children:(0,l.jsxs)("div",{className:"text-red-400 text-sm mt-2 flex items-center",children:[(0,l.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),b]})})]})]}),(0,l.jsxs)("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[(0,l.jsxs)("h4",{className:"text-white font-medium mb-4",children:["线索列表 (",a.length,")"]}),(0,l.jsx)("div",{className:"max-h-60 overflow-y-auto",children:(0,l.jsx)("div",{className:"space-y-3",children:a.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center space-x-4 p-3 bg-white/5 rounded-lg",children:[(0,l.jsx)("div",{className:"flex-shrink-0 w-6 h-6 bg-blue-500/20 rounded-full flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-blue-400 text-xs font-medium",children:t+1})}),(0,l.jsxs)("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-gray-400 text-xs mb-1",children:"姓名"}),(0,l.jsx)("div",{className:"text-white font-medium",children:e.leadName})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-gray-400 text-xs mb-1",children:"手机号"}),(0,l.jsx)("div",{className:"text-white",children:e.phone})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-gray-400 text-xs mb-1",children:"下次跟进时间"}),(0,l.jsx)("div",{className:"text-white",children:S(e.nextFollowTime)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-gray-400 text-xs mb-1",children:"备注"}),(0,l.jsx)("div",{className:"text-white",children:e.remark||"-"})]})]})]},e.id))})})]}),!f&&(0,l.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,l.jsx)("button",{onClick:T,className:"px-6 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors",children:"取消"}),(0,l.jsx)("button",{onClick:L,className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-lg transition-colors",children:"创建任务并同步到DCC"})]})]})})]})})]}):null}function I(e){let{isOpen:t,onClose:s,selectedTaskId:a}=e,[r,i]=(0,n.useState)([]),[c,d]=(0,n.useState)(null),[x,u]=(0,n.useState)(null),[m,h]=(0,n.useState)(!1),[p,b]=(0,n.useState)(null),[j,f]=(0,n.useState)("overview"),[v,N]=(0,n.useState)("all"),[y,w]=(0,n.useState)("all"),[_,k]=(0,n.useState)(null),[C,S]=(0,n.useState)(null),[M,L]=(0,n.useState)(new Set),[T,I]=(0,n.useState)(new Set),[z,A]=(0,n.useState)(!1),[B,E]=(0,n.useState)(!1);(0,n.useEffect)(()=>{t&&a&&(I(new Set),A(!1),E(!1),k(null),S(null),w("all"),N("all"),F())},[t,a]);let W=e=>{f("records"),N(e)};(0,n.useEffect)(()=>{if(!t||!a)return;let e=setInterval(()=>{F()},3e4);return()=>clearInterval(e)},[t,a]);let O=e=>{let t=new Set(T);t.has(e)?t.delete(e):t.add(e),I(t);let s=new Set(R.map(e=>e.id));A(t.size===s.size&&s.size>0)},F=async()=>{if(a){h(!0),b(null);try{let e=await o.Md.getTaskStatistics(a);"success"===e.status?u(e.data):b(e.message||"获取任务统计信息失败");let t=await o.Md.queryTaskExecution(a);if("success"===t.status){let e=t.data,s={id:e.task_id,task_name:e.task_name,task_type:3,create_time:e.query_time,leads_count:e.total_jobs,is_completed:!0};d(s);let l=e.jobs_data.map((e,t)=>{var s,l;let a=null===(s=e.Tasks)||void 0===s?void 0:s[0],r=null===(l=e.Contacts)||void 0===l?void 0:l[0],n=e.follow_data,i=null;void 0!==e.is_interested&&(i=e.is_interested);let c=null;return(null==n?void 0:n.next_follow_time)&&(c=n.next_follow_time),{id:"record_".concat(t),leadName:(null==r?void 0:r.ContactName)||"未知客户",phone:(null==r?void 0:r.PhoneNumber)||(null==a?void 0:a.CalledNumber)||"未知号码",isInterested:i,remark:(null==n?void 0:n.leads_remark)||"",conversation:(null==a?void 0:a.Conversation)||[],followupTime:(null==a?void 0:a.ActualTime)?new Date(a.ActualTime).toLocaleString():"未知时间",callDuration:(null==a?void 0:a.Duration)?Math.floor(a.Duration/1e3):0,nextFollowTime:c}});i(l)}else b(t.message||"获取任务执行情况失败")}catch(e){console.error("获取任务数据失败:",e),b("获取任务数据失败，请重试")}finally{h(!1)}}},H=e=>null===e?"待跟进":0===e?"无法判断":1===e?"有意向":2===e?"无意向":"未知",P=e=>null===e?"text-yellow-400 bg-yellow-500/20":0===e?"text-orange-400 bg-orange-500/20":1===e?"text-green-400 bg-green-500/20":2===e?"text-red-400 bg-red-500/20":"text-gray-400 bg-gray-500/20",R=r.filter(e=>{let t=!0;"pending"===v?t=null===e.isInterested:"unable_to_judge"===v?t=0===e.isInterested:"interested"===v?t=1===e.isInterested:"not_interested"===v&&(t=2===e.isInterested);let s=!0;if("has_next_follow"===y)s=!!e.nextFollowTime;else if("no_next_follow"===y)s=!e.nextFollowTime;else if("custom_range"===y){if(e.nextFollowTime)try{let t=new Date(e.nextFollowTime);s=_&&C?t>=_&&t<=C:_?t>=_:!C||t<=C}catch(e){s=!1}else s=!1}return t&&s}),V=e=>{let t=new Set(M);t.has(e)?t.delete(e):t.add(e),L(t)},U=e=>{if(!e)return"0秒";let t=Math.floor(e/60),s=e%60;return t>0?"".concat(t,"分").concat(s,"秒"):"".concat(s,"秒")},q=e=>{if(!e)return"-";try{return new Date(e).toLocaleString("zh-CN")}catch(t){return e}},J=e=>e?Array.isArray(e)?(0,l.jsx)("div",{className:"space-y-3",children:e.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat("Robot"===e.Speaker?"bg-blue-500/20":"bg-green-500/20"),children:(0,l.jsx)("span",{className:"text-xs font-medium ".concat("Robot"===e.Speaker?"text-blue-400":"text-green-400"),children:"Robot"===e.Speaker?"AI":"客"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("div",{className:"text-xs text-gray-400 mb-1",children:"Robot"===e.Speaker?"AI助手":"客户"}),(0,l.jsx)("div",{className:"text-sm text-white bg-white/5 p-3 rounded-lg",children:e.Script||"无内容"}),e.Summary&&e.Summary.length>0&&(0,l.jsxs)("div",{className:"mt-2 p-2 bg-blue-500/10 border border-blue-500/20 rounded",children:[(0,l.jsx)("div",{className:"text-xs text-blue-400 mb-1",children:"对话摘要："}),e.Summary.map((e,t)=>(0,l.jsxs)("div",{className:"text-xs text-blue-300",children:[e.SummaryName,": ",e.Content]},t))]})]})]},t))}):"object"!=typeof e||Array.isArray(e)?(0,l.jsx)("div",{className:"text-sm text-white bg-white/5 p-3 rounded-lg",children:e}):(0,l.jsx)("div",{className:"space-y-3",children:Object.entries(e).map((e,t)=>{let[s,a]=e;return(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat(s.includes("assistant")||s.includes("ai")?"bg-blue-500/20":"bg-green-500/20"),children:(0,l.jsx)("span",{className:"text-xs font-medium ".concat(s.includes("assistant")||s.includes("ai")?"text-blue-400":"text-green-400"),children:s.includes("assistant")||s.includes("ai")?"AI":"客"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("div",{className:"text-xs text-gray-400 mb-1",children:s.includes("assistant")||s.includes("ai")?"AI助手":"客户"}),(0,l.jsx)("div",{className:"text-sm text-white bg-white/5 p-3 rounded-lg",children:"string"==typeof a?a:JSON.stringify(a)})]})]},t)})}):null;return t?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:s}),(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl w-full max-w-6xl h-[90vh] flex flex-col",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-white/10 flex-shrink-0",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-white",children:"跟进记录Agent"}),(0,l.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"任务执行情况和通话记录"})]}),(0,l.jsx)("button",{onClick:s,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:(0,l.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[m&&(0,l.jsx)("div",{className:"mb-6 p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:(0,l.jsxs)("div",{className:"flex items-center justify-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-400"}),(0,l.jsx)("span",{className:"text-blue-400 ml-2",children:"正在加载任务数据..."})]})}),p&&(0,l.jsx)("div",{className:"mb-6 p-4 bg-red-500/10 border border-red-500/20 rounded-lg",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("svg",{className:"w-5 h-5 text-red-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsx)("span",{className:"text-red-400",children:p})]})}),c&&(0,l.jsxs)("div",{className:"mb-6 p-4 bg-white/5 rounded-lg border border-white/10",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-white font-semibold text-lg",children:c.task_name}),(0,l.jsxs)("p",{className:"text-gray-400 text-sm",children:["创建时间：",c.create_time]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[2===c.task_type&&(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-2 animate-pulse"}),(0,l.jsx)("span",{className:"text-blue-400 text-sm",children:"外呼进行中"})]}),(0,l.jsx)("span",{className:"px-3 py-1 rounded text-sm ".concat(((e,t)=>{if(t)return"text-green-400 bg-green-500/20";switch(e){case 1:case 3:return"text-blue-400 bg-blue-500/20";case 2:return"text-yellow-400 bg-yellow-500/20";case 4:return"text-green-400 bg-green-500/20";default:return"text-gray-400 bg-gray-500/20"}})(c.task_type,c.is_completed)),children:((e,t)=>{if(t)return"已完成";switch(e){case 1:return"已创建";case 2:return"开始外呼";case 3:return"跟进中";case 4:return"跟进完成";default:return"未知状态"}})(c.task_type,c.is_completed)})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"线索数量："}),(0,l.jsx)("span",{className:"text-white",children:c.leads_count})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"任务状态："}),(0,l.jsx)("span",{className:"text-white",children:c.is_completed?"已完成":"进行中"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-400",children:"外呼状态："}),(0,l.jsx)("span",{className:2===c.task_type?"text-blue-400":"text-green-400",children:2===c.task_type?"进行中":"已完成"})]})]})]}),(0,l.jsx)("div",{className:"mb-6",children:(0,l.jsxs)("div",{className:"flex space-x-1 bg-white/5 rounded-lg p-1",children:[(0,l.jsx)("button",{onClick:()=>f("overview"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all ".concat("overview"===j?"bg-blue-500 text-white":"text-gray-400 hover:text-white"),children:"任务概览"}),(0,l.jsx)("button",{onClick:()=>f("records"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all ".concat("records"===j?"bg-blue-500 text-white":"text-gray-400 hover:text-white"),children:"执行记录"})]})}),"overview"===j&&(0,l.jsx)("div",{className:"space-y-6",children:x&&(0,l.jsxs)("div",{className:"p-4 bg-white/5 rounded-lg border border-white/10",children:[(0,l.jsx)("h4",{className:"text-white font-medium mb-4",children:"执行情况详情"}),(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,l.jsxs)("div",{className:"text-center p-3 bg-white/5 rounded-lg",children:[(0,l.jsx)("div",{className:"text-blue-400 font-semibold text-lg",children:x.total_leads}),(0,l.jsx)("div",{className:"text-gray-400 text-xs",children:"线索数量"})]}),(0,l.jsxs)("div",{className:"text-center p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>W("pending"),children:[(0,l.jsx)("div",{className:"text-yellow-400 font-semibold text-lg",children:x.pending_follow}),(0,l.jsx)("div",{className:"text-gray-400 text-xs",children:"待跟进数量"})]}),(0,l.jsxs)("div",{className:"text-center p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>W("unable_to_judge"),children:[(0,l.jsx)("div",{className:"text-orange-400 font-semibold text-lg",children:x.unable_to_judge}),(0,l.jsx)("div",{className:"text-gray-400 text-xs",children:"无法判断数量"})]}),(0,l.jsxs)("div",{className:"text-center p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>W("interested"),children:[(0,l.jsx)("div",{className:"text-green-400 font-semibold text-lg",children:x.interested}),(0,l.jsx)("div",{className:"text-gray-400 text-xs",children:"有意向数量"})]}),(0,l.jsxs)("div",{className:"text-center p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>W("not_interested"),children:[(0,l.jsx)("div",{className:"text-red-400 font-semibold text-lg",children:x.not_interested}),(0,l.jsx)("div",{className:"text-gray-400 text-xs",children:"无意向数量"})]})]})]})}),"records"===j&&(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white",children:"执行记录"}),(0,l.jsxs)("button",{onClick:()=>E(!0),disabled:0===T.size,className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(T.size>0?"bg-blue-500 hover:bg-blue-600 text-white":"bg-white/10 text-gray-400 cursor-not-allowed"),children:["同步DCC (",T.size,")"]})]}),(0,l.jsx)("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"text-gray-400 text-sm whitespace-nowrap",children:"意向筛选："}),(0,l.jsxs)("select",{value:v,onChange:e=>N(e.target.value),className:"bg-white/5 border border-white/20 rounded px-3 py-1 text-sm text-white focus:outline-none focus:border-blue-400",children:[(0,l.jsx)("option",{value:"all",children:"全部"}),(0,l.jsx)("option",{value:"pending",children:"待跟进"}),(0,l.jsx)("option",{value:"unable_to_judge",children:"无法判断"}),(0,l.jsx)("option",{value:"interested",children:"有意向"}),(0,l.jsx)("option",{value:"not_interested",children:"无意向"})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"text-gray-400 text-sm whitespace-nowrap",children:"下次跟进："}),(0,l.jsxs)("select",{value:y,onChange:e=>w(e.target.value),className:"bg-white/5 border border-white/20 rounded px-3 py-1 text-sm text-white focus:outline-none focus:border-blue-400",children:[(0,l.jsx)("option",{value:"all",children:"全部"}),(0,l.jsx)("option",{value:"has_next_follow",children:"有下次跟进"}),(0,l.jsx)("option",{value:"no_next_follow",children:"无下次跟进"}),(0,l.jsx)("option",{value:"custom_range",children:"自定义区间"})]})]}),"custom_range"===y&&(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"text-gray-400 text-sm whitespace-nowrap",children:"时间区间："}),(0,l.jsx)(g.ZP,{selected:_,onChange:e=>k(e),selectsStart:!0,startDate:_||void 0,endDate:C||void 0,className:"bg-white/5 border border-white/20 rounded px-3 py-1 text-sm text-white placeholder-gray-400 focus:outline-none focus:border-blue-400",placeholderText:"开始时间",dateFormat:"yyyy-MM-dd HH:mm",showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15}),(0,l.jsx)("span",{className:"text-gray-400 text-sm",children:"至"}),(0,l.jsx)(g.ZP,{selected:C,onChange:e=>S(e),selectsEnd:!0,startDate:_||void 0,endDate:C||void 0,minDate:_||void 0,className:"bg-white/5 border border-white/20 rounded px-3 py-1 text-sm text-white placeholder-gray-400 focus:outline-none focus:border-blue-400",placeholderText:"结束时间",dateFormat:"yyyy-MM-dd HH:mm",showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15})]}),(0,l.jsx)("div",{className:"flex items-center space-x-2 ml-auto",children:(0,l.jsxs)("span",{className:"text-gray-400 text-sm",children:["筛选结果：",R.length,"/",r.length]})})]})}),R.length>0&&(0,l.jsxs)("div",{className:"flex items-center space-x-3 p-3 bg-white/5 rounded-lg",children:[(0,l.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,l.jsx)("input",{type:"checkbox",checked:z,onChange:()=>{z?(I(new Set),A(!1)):(I(new Set(R.map(e=>e.id))),A(!0))},className:"w-4 h-4 text-blue-500 bg-white/10 border-white/20 rounded focus:ring-blue-400 focus:ring-2"}),(0,l.jsx)("span",{className:"text-white text-sm",children:"全选"})]}),(0,l.jsxs)("span",{className:"text-gray-400 text-sm",children:["已选择 ",T.size," 条记录"]})]}),0===R.length?(0,l.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,l.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,l.jsx)("p",{children:"暂无符合条件的执行记录"})]}):(0,l.jsx)("div",{className:"space-y-4",children:R.map(e=>{var t,s;return(0,l.jsxs)("div",{className:"bg-white/5 rounded-lg border border-white/10 overflow-hidden",children:[(0,l.jsx)("div",{className:"p-4",children:(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,l.jsx)("div",{className:"flex-shrink-0 pt-1",children:(0,l.jsx)("input",{type:"checkbox",checked:T.has(e.id),onChange:()=>O(e.id),className:"w-4 h-4 text-blue-500 bg-white/10 border-white/20 rounded focus:ring-blue-400 focus:ring-2"})}),(0,l.jsxs)("div",{className:"flex-1 cursor-pointer",onClick:()=>V(e.id),children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-gray-400 text-xs mb-1",children:"姓名"}),(0,l.jsx)("div",{className:"text-white font-medium",children:e.leadName})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-gray-400 text-xs mb-1",children:"手机号"}),(0,l.jsx)("div",{className:"text-white",children:e.phone})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-gray-400 text-xs mb-1",children:"有无意向"}),(0,l.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat(P(null!==(t=e.isInterested)&&void 0!==t?t:null)),children:H(null!==(s=e.isInterested)&&void 0!==s?s:null)})]}),1===e.isInterested&&(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-gray-400 text-xs mb-1",children:"下次跟进时间"}),(0,l.jsx)("div",{className:"text-white text-sm",children:q(e.nextFollowTime)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-gray-400 text-xs mb-1",children:"备注"}),(0,l.jsx)("div",{className:"text-white text-sm",children:e.remark||"-"})]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-white/10",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-400",children:[e.followupTime&&(0,l.jsxs)("span",{children:["执行时间：",e.followupTime]}),e.callDuration&&(0,l.jsxs)("span",{children:["通话时长：",U(e.callDuration)]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"text-xs text-gray-400",children:M.has(e.id)?"收起":"展开对话"}),(0,l.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition-transform ".concat(M.has(e.id)?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})]})]})}),M.has(e.id)&&e.conversation&&(0,l.jsx)("div",{className:"px-4 pb-4 border-t border-white/10",children:(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsxs)("div",{className:"flex items-center mb-3",children:[(0,l.jsx)("svg",{className:"w-4 h-4 text-purple-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,l.jsx)("span",{className:"text-purple-400 font-medium text-sm",children:"通话对话"})]}),J(e.conversation)]})})]},e.id)})})]})]})]})}),(0,l.jsx)(D,{isOpen:B,onClose:()=>E(!1),selectedRecords:R.filter(e=>T.has(e.id))})]}):null}function z(e){let{isOpen:t,onClose:s,onTaskSelect:a}=e,[r,i]=(0,n.useState)([]),[c,d]=(0,n.useState)(!1),[x,u]=(0,n.useState)(null);(0,n.useEffect)(()=>{t&&m()},[t]);let m=async()=>{d(!0),u(null);try{let e=await o.Md.getCallTasksList();if("success"===e.status){let t=(e.data||[]).filter(e=>2===e.task_type||3===e.task_type||4===e.task_type);i(t)}else u(e.message||"获取任务列表失败")}catch(e){console.error("获取任务列表失败:",e),u("获取任务列表失败，请重试")}finally{d(!1)}},h=e=>{switch(e){case 1:return"已创建";case 2:return"外呼进行中";case 3:return"跟进中";case 4:return"跟进完成";default:return"未知状态"}},p=e=>{switch(e){case 1:case 3:return"text-blue-400 bg-blue-500/20";case 2:return"text-yellow-400 bg-yellow-500/20";case 4:return"text-green-400 bg-green-500/20";default:return"text-gray-400 bg-gray-500/20"}},g=e=>{a(e),s()};return(0,l.jsxs)(l.Fragment,{children:[t&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:s}),(0,l.jsx)("div",{className:"\n        fixed inset-0 flex items-center justify-center z-50\n        ".concat(t?"opacity-100":"opacity-0 pointer-events-none","\n        transition-opacity duration-300\n      "),children:(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-xl border border-white/20 rounded-lg p-6 w-[500px] max-h-[600px] overflow-y-auto",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-white",children:"选择任务"}),(0,l.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"查看外呼进行中、已完成和跟进完成的任务"})]}),(0,l.jsx)("button",{onClick:s,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:(0,l.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c&&(0,l.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400"}),(0,l.jsx)("span",{className:"text-blue-400 ml-3",children:"正在加载任务列表..."})]}),x&&(0,l.jsx)("div",{className:"mb-4 p-4 bg-red-500/10 border border-red-500/20 rounded-lg",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("svg",{className:"w-5 h-5 text-red-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,l.jsx)("span",{className:"text-red-400",children:x})]})}),!c&&!x&&(0,l.jsx)("div",{className:"space-y-3",children:0===r.length?(0,l.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,l.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),(0,l.jsx)("p",{children:"暂无相关任务"}),(0,l.jsx)("p",{className:"text-xs mt-2",children:"请等待任务开始执行后再查看"})]}):r.map(e=>(0,l.jsxs)("div",{onClick:()=>g(e),className:"p-4 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 cursor-pointer transition-colors",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h3",{className:"text-white font-medium",children:e.task_name}),(0,l.jsxs)("p",{className:"text-gray-400 text-sm",children:["创建时间：",new Date(e.create_time).toLocaleString()]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[2===e.task_type&&(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full mr-1 animate-pulse"}),(0,l.jsx)("span",{className:"text-blue-400 text-xs",children:"外呼中"})]}),(0,l.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat(p(e.task_type)),children:h(e.task_type)})]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,l.jsxs)("span",{className:"text-gray-400",children:["线索数量：",e.leads_count]}),(0,l.jsx)("span",{className:"text-blue-400 text-xs",children:"点击查看执行记录"})]})]},e.id))}),(0,l.jsx)("div",{className:"mt-6 flex justify-end",children:(0,l.jsx)("button",{onClick:s,className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"取消"})})]})})]})}let A="\n  @keyframes robot-pulse {\n    0%, 100% {\n      transform: scale(1);\n      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);\n    }\n    50% {\n      transform: scale(1.05);\n      box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);\n    }\n  }\n\n  @keyframes robot-glow {\n    0%, 100% {\n      opacity: 0.5;\n      transform: scale(1);\n    }\n    50% {\n      opacity: 1;\n      transform: scale(1.1);\n    }\n  }\n\n  .robot-working {\n    animation: robot-pulse 2s ease-in-out infinite;\n  }\n\n  .robot-glow {\n    animation: robot-glow 3s ease-in-out infinite;\n  }\n\n  .line-clamp-2 {\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n  }\n";function B(){(0,i.useRouter)();let{user:e,loading:t}=(0,c.a)(),[s,a]=(0,n.useState)([{id:"task",name:"任务Agent",description:"智能任务分配和管理，优化工作流程",icon:"\uD83D\uDCCB",status:"idle",progress:0,stats:{total:0,completed:0,current:0}},{id:"script",name:"话术生成Agent",description:"智能生成个性化话术，提升沟通效果",icon:"\uD83D\uDCAC",status:"idle",progress:0,stats:{total:0,completed:0,current:0}},{id:"calling",name:"外呼Agent",description:"智能外呼客户，自动语音交互",icon:"\uD83D\uDCDE",status:"idle",progress:0,stats:{total:0,completed:0,current:0}},{id:"followup",name:"跟进Agent",description:"监控进行中的线索和已完成的任务",icon:"\uD83D\uDCDD",status:"idle",progress:0,stats:{total:0,completed:0,current:0}}]),[x,u]=(0,n.useState)(null),[g,j]=(0,n.useState)(!1),[v,y]=(0,n.useState)(!1),[_,C]=(0,n.useState)(!1),[M,L]=(0,n.useState)(!1),[D,B]=(0,n.useState)(!1),[E,W]=(0,n.useState)(!1),[O,F]=(0,n.useState)(!1),[H,P]=(0,n.useState)(null),[R,V]=(0,n.useState)([]),[U,q]=(0,n.useState)([]),[J,G]=(0,n.useState)(!1),[Y,$]=(0,n.useState)(!1),[Z,K]=(0,n.useState)(!1),[Q,X]=(0,n.useState)([]),[ee,et]=(0,n.useState)(null),[es,el]=(0,n.useState)(!1),[ea,er]=(0,n.useState)(!1),[en,ei]=(0,n.useState)(null),[ec,eo]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=async()=>{if(Y)try{let e=await o.Md.getCallTasksStatistics();if("success"===e.status){let t=e.data;console.log("DEBUG - Task statistics response:",e),console.log("DEBUG - Stats data:",t);let s=t.reduce((e,t)=>(e[t.task_type]=t,e),{});setTimeout(()=>{a(e=>e.map(e=>{switch(e.id){case"task":let t=s[1]||{count:0,leads_count:0};return{...e,stats:{total:t.count,completed:0,current:t.count}};case"script":let l=s[1]||{count:0,leads_count:0};return{...e,stats:{total:l.count,completed:0,current:l.count},status:l.count>0?"working":"idle"};case"calling":let a=s[2]||{count:0,leads_count:0},r=s[3]||{count:0,leads_count:0},n=a.count+r.count;return{...e,stats:{total:n,completed:r.count,current:a.count},status:a.count>0?"working":"idle"};case"followup":let i=s[3]||{count:0,leads_count:0},c=s[4]||{count:0,leads_count:0};return{...e,stats:{total:i.count+c.count,completed:c.count,current:i.count},status:i.count>0||c.count>0?"working":"idle"};default:return e}}))},0)}}catch(e){console.error("获取任务统计数据失败:",e)}};e();let t=setInterval(e,1e4);return()=>clearInterval(t)},[Y]),(0,n.useEffect)(()=>(console.log("Home page mounted"),(0,d.MI)()),[]),(0,n.useEffect)(()=>{let e=setTimeout(()=>{let e=localStorage.getItem("user");e&&(JSON.parse(e).dcc_user?$(!0):($(!1),G(!0)))},500);return()=>clearTimeout(e)},[]);let ed=async e=>{try{let s=await o.Md.getCallTaskDetails(e);if("success"===s.status){var t;console.log("任务详情已刷新:",s.data),O&&(null==H?void 0:null===(t=H.task_info)||void 0===t?void 0:t.id)===parseInt(e)&&P(s.data)}}catch(e){console.error("刷新任务详情失败:",e)}},ex=async()=>{try{let e=await o.Md.getCallTasksList();if("success"===e.status){let t=(e.data.tasks||[]).filter(e=>2===e.task_type||3===e.task_type||4===e.task_type).map(e=>({id:e.id.toString(),name:e.task_name,createdAt:new Date(e.create_time).toLocaleString(),conditions:[],targetCount:e.leads_count,filteredCount:e.leads_count,status:3===e.task_type||4===e.task_type?"completed":"calling",organization_id:e.organization_id,create_name:e.create_name,script_id:e.script_id,task_type:e.task_type,size_desc:e.size_desc}));X(t)}}catch(e){console.error("刷新任务列表失败:",e)}},eu=async e=>{if(!Y){alert("请先绑定DCC账号才能进行操作"),G(!0);return}if(u(e),"task"===e){y(!0);return}if("script"===e){try{let e=await o.Md.getScriptTasksList();if("success"===e.status){let t=(e.data||[]).map(e=>({id:e.id.toString(),name:e.task_name,createdAt:new Date(e.create_time).toLocaleString(),conditions:[],targetCount:e.leads_count,filteredCount:e.leads_count,status:"pending",organization_id:e.organization_id,create_name:e.create_name,script_id:e.script_id,task_type:e.task_type,size_desc:e.size_desc}));X(t),L(!0)}else console.error("获取话术生成任务列表失败:",e.message),alert("获取话术生成任务列表失败，请重试")}catch(e){console.error("获取话术生成任务列表失败:",e),alert("获取话术生成任务列表失败，请重试")}return}if("calling"===e){try{console.log("外呼Agent clicked, 开始获取任务列表...");let e=await o.Md.getCallTasksList();if("success"===e.status){let t=e.data||[],s=t.filter(e=>2===e.task_type||3===e.task_type);if(console.log("DEBUG - All tasks:",t),console.log("DEBUG - Filtered tasks (type 2 or 3):",s),0===s.length){alert("暂无外呼中或外呼完成的任务，请先发起任务并发起外呼");return}let l=s.map(e=>({id:e.id.toString(),name:e.task_name,createdAt:new Date(e.create_time).toLocaleString(),conditions:[],targetCount:e.leads_count,filteredCount:e.leads_count,status:3===e.task_type?"completed":"calling",organization_id:e.organization_id,create_name:e.create_name,script_id:e.script_id,task_type:e.task_type,size_desc:e.size_desc}));X(l),console.log("显示外呼Agent监控界面"),el(!0)}else console.error("获取任务列表失败:",e.message),alert("获取任务列表失败，请重试")}catch(e){console.error("获取任务列表失败:",e),alert("获取任务列表失败，请重试")}return}if("followup"===e){try{let e=await o.Md.getCallTasksList();if("success"===e.status){let t=(e.data||[]).filter(e=>3===e.task_type||4===e.task_type);if(0===t.length){alert("暂无跟进中或跟进完成的任务，请等待任务进入跟进阶段");return}let s=t.map(e=>({id:e.id.toString(),name:e.task_name,createdAt:new Date(e.create_time).toLocaleString(),conditions:[],targetCount:e.leads_count,filteredCount:e.leads_count,status:4===e.task_type?"completed":"calling",organization_id:e.organization_id,create_name:e.create_name,script_id:e.script_id,task_type:e.task_type,size_desc:e.size_desc}));X(s),eo(!0)}else console.error("获取任务列表失败:",e.message),alert("获取任务列表失败，请重试")}catch(e){console.error("获取任务列表失败:",e),alert("获取任务列表失败，请重试")}return}},em=e=>{switch(e){case"working":return"text-blue-400";case"error":return"text-red-400";default:return"text-gray-400"}},eh=e=>({idle:"空闲",working:"工作中",error:"错误"})[e]||e;return t?(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)("div",{className:"inline-flex items-center space-x-3 mb-4",children:[(0,l.jsx)("div",{className:"w-3 h-3 bg-green-400 rounded-full animate-pulse"}),(0,l.jsx)("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:"DCC 数字员工"}),(0,l.jsx)("div",{className:"w-3 h-3 bg-blue-400 rounded-full animate-pulse delay-500"})]}),(0,l.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-400"}),(0,l.jsx)("span",{className:"text-gray-300 text-sm",children:t?"正在加载...":"正在验证登录状态..."})]})]})}):e?(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900",children:[(0,l.jsx)(r(),{id:A.__hash,children:A}),(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" fixed inset-0 overflow-hidden pointer-events-none",children:[(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(120,119,198,0.1),transparent_50%)]"}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" absolute top-1/4 left-1/4 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl animate-pulse"}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl animate-pulse delay-1000"})]}),(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" relative z-10",children:[(0,l.jsx)(m,{}),(0,l.jsx)("main",{className:"jsx-".concat(A.__hash)+" pt-4 px-4 sm:px-6 lg:px-8 h-[calc(100vh-4rem)] overflow-y-auto",children:(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" max-w-7xl mx-auto",children:[(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" mb-4 flex justify-between items-center",children:(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash),children:[(0,l.jsx)("h1",{className:"jsx-".concat(A.__hash)+" text-2xl font-bold text-white mb-1",children:"Agent工作台"}),(0,l.jsx)("p",{className:"jsx-".concat(A.__hash)+" text-gray-300 text-sm",children:Y?"监控和管理您的智能Agent团队":"请先绑定DCC账号以开始使用"}),!Y&&(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" mt-2 p-2 bg-yellow-500/20 border border-yellow-500/30 rounded-lg",children:(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" flex items-center",children:[(0,l.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"jsx-".concat(A.__hash)+" w-4 h-4 text-yellow-400 mr-2",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z",className:"jsx-".concat(A.__hash)})}),(0,l.jsx)("span",{className:"jsx-".concat(A.__hash)+" text-yellow-200 text-xs",children:"需要绑定DCC账号才能使用系统功能"})]})})]})}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:s.map(e=>(0,l.jsx)("div",{className:"jsx-".concat(A.__hash),children:(0,l.jsxs)("div",{onClick:()=>eu(e.id),className:"jsx-".concat(A.__hash)+" "+"\n                      relative group transition-all duration-500 transform\n                      bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10 p-4\n                      min-h-[280px] flex flex-col justify-between\n                      ".concat(Y?"cursor-pointer hover:scale-105 hover:bg-white/10 hover:border-white/20 hover:shadow-2xl":"cursor-not-allowed opacity-60","\n                      ").concat(x===e.id?"ring-2 ring-blue-500/50":"","\n                      ").concat("calling"===e.id&&"working"===e.status?"robot-working":"","\n                      ").concat("followup"===e.id&&"working"===e.status?"robot-working":"","\n                    "),children:[("calling"===e.id||"followup"===e.id)&&"working"===e.status&&(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" absolute top-3 right-3",children:[(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" "+"w-2 h-2 rounded-full animate-pulse ".concat("calling"===e.id?"bg-blue-400":"bg-green-400")}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" "+"absolute inset-0 w-2 h-2 rounded-full animate-ping opacity-75 ".concat("calling"===e.id?"bg-blue-400":"bg-green-400")})]}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-center mb-3",children:(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" "+"\n                        relative inline-flex items-center justify-center w-12 h-12 rounded-xl\n                        text-2xl mb-2 transition-all duration-300 group-hover:scale-110\n                        ".concat("calling"===e.id&&"working"===e.status?"bg-gradient-to-br from-blue-500 to-purple-600 robot-glow":"followup"===e.id&&"working"===e.status?"bg-gradient-to-br from-green-500 to-blue-600 robot-glow":"bg-gradient-to-br from-gray-600 to-gray-700","\n                      "),children:[e.icon,"calling"===e.id&&"working"===e.status&&(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" absolute inset-0 rounded-xl border-2 border-blue-400/50 animate-spin"}),"followup"===e.id&&"working"===e.status&&(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" absolute inset-0 rounded-xl border-2 border-green-400/50 animate-spin"})]})}),(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" text-center flex-1 flex flex-col justify-between",children:[(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash),children:[(0,l.jsx)("h3",{className:"jsx-".concat(A.__hash)+" text-base font-semibold text-white mb-1",children:e.name}),(0,l.jsx)("p",{className:"jsx-".concat(A.__hash)+" text-xs text-gray-300 mb-3 line-clamp-2",children:e.description}),("calling"===e.id||"followup"===e.id)&&(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" flex items-center justify-center mb-3",children:[(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" "+"w-1.5 h-1.5 rounded-full mr-1.5 ".concat(em(e.status))}),(0,l.jsx)("span",{className:"jsx-".concat(A.__hash)+" "+"text-xs ".concat(em(e.status)),children:eh(e.status)}),"working"===e.status&&(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" ml-2 text-xs text-blue-400 animate-pulse",children:"点击查看"})]})]}),(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" mt-auto",children:[("calling"===e.id||"followup"===e.id||"script"===e.id)&&(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" grid grid-cols-3 gap-2 text-center mb-3",children:["calling"===e.id&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" text-center",children:[(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-blue-400 font-semibold text-sm",children:e.stats.total}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-gray-400 text-xs",children:"总外呼任务"})]}),(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" text-center",children:[(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-green-400 font-semibold text-sm",children:e.stats.completed}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-gray-400 text-xs",children:"外呼完成"})]}),(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" text-center",children:[(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-blue-400 font-semibold text-sm",children:e.stats.current}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-gray-400 text-xs",children:"外呼中"})]})]}),"followup"===e.id&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" text-center",children:[(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-blue-400 font-semibold text-sm",children:e.stats.total}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-gray-400 text-xs",children:"总跟进任务"})]}),(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" text-center",children:[(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-green-400 font-semibold text-sm",children:e.stats.completed}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-gray-400 text-xs",children:"跟进完成"})]}),(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" text-center",children:[(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-blue-400 font-semibold text-sm",children:e.stats.current}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-gray-400 text-xs",children:"跟进中"})]})]}),"script"===e.id&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" text-center",children:[(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-blue-400 font-semibold text-sm",children:e.stats.total}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-gray-400 text-xs",children:"总任务"})]}),(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" text-center",children:[(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-green-400 font-semibold text-sm",children:e.stats.completed}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-gray-400 text-xs",children:"已生成"})]}),(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" text-center",children:[(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-blue-400 font-semibold text-sm",children:e.stats.current}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-gray-400 text-xs",children:"待生成"})]})]})]}),"task"===e.id&&(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" h-[60px] flex items-center justify-center",children:(0,l.jsxs)("div",{className:"jsx-".concat(A.__hash)+" text-center",children:[(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-gray-400 text-xs",children:"任务管理"}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-gray-500 text-xs mt-1",children:"智能分配"})]})}),"working"!==e.status&&(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" text-xs text-gray-400 mt-2 text-center",children:Y?"task"===e.id?"点击创建任务":"script"===e.id?"点击生成话术":"calling"===e.id?"点击查看外呼任务":"followup"===e.id?"点击查看跟进记录":"等待外呼活动开始":"请先绑定DCC账号"})]})]}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" absolute inset-0 rounded-2xl bg-gradient-to-r from-blue-500/0 to-purple-500/0 opacity-0 group-hover:opacity-10 transition-opacity duration-300"}),(0,l.jsx)("div",{className:"jsx-".concat(A.__hash)+" absolute inset-0 rounded-2xl bg-blue-500/0 group-active:bg-blue-500/20 transition-all duration-150"})]})},e.id))})]})})]}),(0,l.jsx)(h,{isOpen:g,onClose:()=>j(!1),records:U,currentTasks:R}),(0,l.jsx)(p,{isOpen:J,onClose:()=>G(!1),onBindSuccess:()=>$(!0)}),(0,l.jsx)(f,{isOpen:_,onClose:()=>C(!1),tasks:Q,onViewTaskDetails:e=>{P(e),F(!0)}}),(0,l.jsx)(N,{isOpen:M,onClose:()=>L(!1),onTaskSelect:e=>{et(e),L(!1),W(!0)},tasks:Q}),(0,l.jsx)(k,{isOpen:E,onClose:()=>W(!1),selectedTask:ee,onConfigureScript:e=>{W(!1),B(!0)},onStartCalling:e=>{console.log("开始外呼任务:",e)},onOutboundCallSuccess:ex}),(0,l.jsx)(w,{isOpen:D,onClose:()=>B(!1),selectedTask:ee,onBackToTaskDetail:()=>{B(!1),W(!0)}}),(0,l.jsx)(S,{isOpen:O,onClose:()=>F(!1),taskInfo:null==H?void 0:H.task_info,taskLeads:(null==H?void 0:H.task_details)||[],onRefresh:()=>{var e;(null==H?void 0:null===(e=H.task_info)||void 0===e?void 0:e.id)&&ed(H.task_info.id.toString())}}),(0,l.jsx)(b,{isOpen:v,onClose:()=>y(!1),onTaskCreated:e=>{console.log("任务创建成功:",e),y(!1)}}),(0,l.jsx)(T,{isOpen:es,onClose:()=>el(!1),callingTasks:Q,onTasksUpdate:e=>{X(t=>{let s=[...t];return e.forEach(e=>{let t=s.findIndex(t=>t.id===e.id);-1!==t&&(s[t]=e)}),s})},onRefreshTaskDetails:ed}),(0,l.jsx)(I,{isOpen:ea,onClose:()=>er(!1),selectedTaskId:null==en?void 0:en.id}),(0,l.jsx)(z,{isOpen:ec,onClose:()=>eo(!1),onTaskSelect:e=>{ei(e),er(!0)}})]}):null}},1478:function(){}},function(e){e.O(0,[721,282,333,406,855,971,117,744],function(){return e(e.s=4224)}),_N_E=e.O()}]);
exports.id=395,exports.ids=[395],exports.modules={8588:(t,e,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},6685:(t,e,s)=>{Promise.resolve().then(s.bind(s,4591)),Promise.resolve().then(s.bind(s,49))},5941:(t,e,s)=>{"use strict";s.d(e,{CT:()=>i});let o={API_BASE_URL:process.env.NEXT_PUBLIC_API_BASE_URL||"https://your-production-domain.com/api",NODE_ENV:"production"},i=o.API_BASE_URL;o.NODE_ENV,o.NODE_ENV,o.NODE_ENV},4591:(t,e,s)=>{"use strict";s.d(e,{AuthProvider:()=>_,a:()=>k});var o=s(326),i=s(7577),a=s(5047),r=s(1471),n=s(3322);class c{constructor(){this.timeoutId=null,this.lastActivityTime=Date.now(),this.isMonitoring=!1,this.INACTIVITY_TIMEOUT=18e5,this.CHECK_INTERVAL=6e5,this.lastTokenCheck=0,this.TOKEN_CHECK_COOLDOWN=3e5,this.setupEventListeners()}setupEventListeners(){["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach(t=>{document.addEventListener(t,()=>this.handleUserActivity(),{passive:!0})}),document.addEventListener("visibilitychange",()=>this.handleVisibilityChange())}handleUserActivity(){this.lastActivityTime=Date.now()}handleVisibilityChange(){"visible"===document.visibilityState&&Date.now()-this.lastActivityTime>this.INACTIVITY_TIMEOUT&&this.checkTokenValidity()}startMonitoring(){this.isMonitoring=!0,this.scheduleNextCheck()}scheduleNextCheck(){this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.checkInactivity()},this.CHECK_INTERVAL)}checkInactivity(){Date.now()-this.lastActivityTime>this.INACTIVITY_TIMEOUT?this.checkTokenValidity():this.scheduleNextCheck()}async checkTokenValidity(){let t=Date.now();if(t-this.lastTokenCheck<this.TOKEN_CHECK_COOLDOWN){console.log("活动监听器：Token检查在冷却期内，跳过"),this.scheduleNextCheck();return}try{if(console.log("活动监听器：检查token有效性..."),this.lastTokenCheck=t,!await (0,r.sT)()){console.log("活动监听器：Token无效，处理token失效"),this.handleTokenExpired();return}console.log("活动监听器：Token有效，继续监控"),this.scheduleNextCheck()}catch(t){console.error("活动监听器：Token验证失败:",t),this.handleTokenExpired()}}handleTokenExpired(){console.log("活动监听器：Token已失效，正在跳转到登录页面..."),this.stopMonitoring(),(0,n.Ee)()}stopMonitoring(){console.log("活动监听器：停止监控"),this.isMonitoring=!1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}resetActivity(){this.lastActivityTime=Date.now()}start(){console.log("活动监听器：开始监控"),this.lastActivityTime=Date.now(),this.startMonitoring()}}let l=null,d=()=>(l||(l=new c),l);var h=s(5941);let u=(0,i.createContext)(void 0);function _({children:t}){let[e,s]=(0,i.useState)(null),[r,n]=(0,i.useState)(!0),c=(0,a.useRouter)(),l=async(t,e)=>{n(!0);try{let o=await fetch(`${h.CT}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:e})});if(!o.ok)throw Error("登录失败");let i=await o.json();if("success"===i.status&&i.data){let{user_info:t,access_token:e}=i.data,o={username:t.username,dcc_user:t.dcc_user};localStorage.setItem("user",JSON.stringify(o)),localStorage.setItem("access_token",e),document.cookie=`user=${JSON.stringify({username:t.username})}; path=/; max-age=86400; samesite=lax`,document.cookie=`access_token=${e}; path=/; max-age=86400; samesite=lax`,t.dcc_user||sessionStorage.setItem("needBindDcc","true"),s(o),d().start(),c.push("/")}else throw Error(i.message||"登录失败")}catch(t){if(t instanceof Error)throw t;throw Error("登录失败")}finally{n(!1)}};return o.jsx(u.Provider,{value:{user:e,login:l,logout:()=>{console.log("AuthContext：用户登出"),d().stopMonitoring(),localStorage.removeItem("user"),localStorage.removeItem("access_token"),document.cookie="user=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="access_token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",s(null),c.push("/login")},loading:r},children:t})}function k(){let t=(0,i.useContext)(u);if(void 0===t)throw Error("useAuth must be used within an AuthProvider");return t}},49:(t,e,s)=>{"use strict";s.d(e,{ThemeProvider:()=>r});var o=s(326),i=s(7577);let a=(0,i.createContext)(void 0),r=({children:t})=>{let[e,s]=(0,i.useState)(()=>"light");return(0,i.useEffect)(()=>{document.documentElement.classList.remove("dark","light"),document.documentElement.classList.add(e),localStorage.setItem("theme",e)},[e]),o.jsx(a.Provider,{value:{theme:e,toggleTheme:()=>{let t="dark"===e?"light":"dark";s(t),localStorage.setItem("theme",t)}},children:t})}},1471:(t,e,s)=>{"use strict";s.d(e,{F:()=>_,LM:()=>h,Md:()=>u,sT:()=>n});var o=s(3322),i=s(5941);let a={token:null,isValid:!1,lastCheck:0,cacheDuration:3e5},r=()=>{let t=localStorage.getItem("access_token");return a.token=t,t},n=async()=>{let t=r();if(!t)return a.isValid=!1,!1;let e=Date.now();if(a.token===t&&a.isValid&&e-a.lastCheck<a.cacheDuration)return!0;try{let s=await fetch(`${i.CT}/auth/verify`,{method:"GET",headers:{"Content-Type":"application/json","access-token":t}});if(s.ok){let t=await s.json(),o="success"===t.status;return a.isValid=o,a.lastCheck=e,o}return a.isValid=!1,a.lastCheck=e,!1}catch(t){return console.error("Token验证失败:",t),a.isValid=!1,a.lastCheck=e,!1}},c=async()=>{let t=r();if(!t)return!1;a.token!==t&&(a.isValid=!1,a.lastCheck=0);let e=Date.now();return!!a.isValid&&e-a.lastCheck<a.cacheDuration||await n()},l=()=>{a.isValid=!1,a.lastCheck=0},d=async(t,e={})=>{let s=r();if(!s)throw console.log("未找到token，跳转到登录页面"),(0,o.Ee)(),Error("未登录，请先登录");let a=c(),n={"Content-Type":"application/json",...s&&{"access-token":s}},d={...e,headers:{...n,...e.headers}};try{let e=await fetch(`${i.CT}${t}`,d);if(401===e.status)throw console.log("收到401响应，token无效，跳转到登录页面"),l(),(0,o.Ee)(),Error("登录已过期，请重新登录");if(!e.ok)throw Error(`API请求失败: ${e.status}`);return a.then(t=>{t||l()}).catch(()=>{l()}),e.json()}catch(t){if(t instanceof TypeError&&(console.log("网络错误，检查token有效性"),!await a))throw l(),(0,o.Ee)(),Error("登录已过期，请重新登录");throw t}},h={getStatistics:async t=>d(`/leads/statistics?filter_by=${t}`),getFilteredStatistics:async(t,e)=>d(`/leads/statistics/filtered?filter_by=${e}`,{method:"POST",body:JSON.stringify(t)}),getFilteredCount:async(t,e)=>{let s=new URLSearchParams;return e&&s.append("filter_by",e),t.leads_product&&s.append("leads_product",t.leads_product),t.leads_type&&s.append("leads_type",t.leads_type),t.first_follow_start&&s.append("first_follow_start",t.first_follow_start),t.first_follow_end&&s.append("first_follow_end",t.first_follow_end),t.latest_follow_start&&s.append("latest_follow_start",t.latest_follow_start),t.latest_follow_end&&s.append("latest_follow_end",t.latest_follow_end),t.next_follow_start&&s.append("next_follow_start",t.next_follow_start),t.next_follow_end&&s.append("next_follow_end",t.next_follow_end),t.first_arrive_start&&s.append("first_arrive_start",t.first_arrive_start),t.first_arrive_end&&s.append("first_arrive_end",t.first_arrive_end),void 0!==t.is_arrive&&s.append("is_arrive",t.is_arrive.toString()),d(`/leads/statistics?${s.toString()}`)}},u={getCallTasksList:async()=>d("/tasks"),getScriptTasksList:async()=>d("/tasks"),getCallTasksStatistics:async()=>d("/task-stats"),getCallTaskDetails:async t=>d(`/call-tasks/list?task_id=${t}`),getTaskFollowupRecords:async t=>d(`/task_followup_records/${t}`),createCallTask:async t=>d("/create-autoCall-tasks",{method:"POST",body:JSON.stringify(t)}),createTask:async t=>d("/tasks/create",{method:"POST",body:JSON.stringify(t)}),createOutboundCall:async t=>d("/create_outbound_call",{method:"POST",body:JSON.stringify(t)}),queryOutboundCall:async t=>d("/query_outbound_call",{method:"POST",body:JSON.stringify({job_ids:t})}),checkTaskStatus:async t=>d(`/check_task_status/${t}`),getTaskStatusDetails:async t=>d(`/task_status_details/${t}`),queryTaskExecution:async t=>d("/query-task-execution",{method:"POST",body:JSON.stringify({task_id:t})}),getTaskStatistics:async t=>d("/task-statistics",{method:"POST",body:JSON.stringify({task_id:t})}),getCompletedTasksList:async()=>d("/tasks"),batchCheckTaskStatus:async t=>d("/batch_check_task_status",{method:"POST",body:JSON.stringify({job_ids:t})}),updateTaskScriptId:async(t,e)=>d("/update-script-id",{method:"POST",body:JSON.stringify({task_id:t,script_id:e})}),startCallTask:async t=>d("/start-call-task",{method:"POST",body:JSON.stringify({task_id:t})}),suspendResumeTask:async(t,e)=>d("/suspend-resume-task",{method:"POST",body:JSON.stringify({action:e,task_id:t})})},_={getScenes:async()=>d("/scenes"),getSceneDetails:async t=>d(`/scenes/${t}`),createScene:async t=>d("/create_scene",{method:"POST",body:JSON.stringify(t)})}},3322:(t,e,s)=>{"use strict";s.d(e,{Ee:()=>o}),s(1471);let o=()=>{console.log("Token已失效，正在跳转到登录页面..."),localStorage.removeItem("access_token"),localStorage.removeItem("user"),document.cookie="user=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",document.cookie="access_token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT"}},4763:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>d,metadata:()=>l});var o=s(9510),i=s(734),a=s.n(i);s(5023);var r=s(8570);(0,r.createProxy)(String.raw`/Users/wedo/Documents/product/DCC数字员工/V1.0/dcc-digital-employee/src/contexts/ThemeContext.tsx#useTheme`);let n=(0,r.createProxy)(String.raw`/Users/wedo/Documents/product/DCC数字员工/V1.0/dcc-digital-employee/src/contexts/ThemeContext.tsx#ThemeProvider`),c=(0,r.createProxy)(String.raw`/Users/wedo/Documents/product/DCC数字员工/V1.0/dcc-digital-employee/src/contexts/AuthContext.tsx#AuthProvider`);(0,r.createProxy)(String.raw`/Users/wedo/Documents/product/DCC数字员工/V1.0/dcc-digital-employee/src/contexts/AuthContext.tsx#useAuth`);let l={title:"数字员工平台",description:"管理和监控数字员工的现代化SAAS平台"};function d({children:t}){return o.jsx("html",{lang:"zh-CN",children:o.jsx("body",{className:`${a().className} transition-colors duration-200`,suppressHydrationWarning:!0,children:o.jsx(n,{children:o.jsx(c,{children:t})})})})}},5023:()=>{}};